<!DOCTYPE HTML>
<html lang="en">
<head>
  <!-- Autogenerated from  on Fri Feb 27 00:42:27 2026 -->
  <meta charset="UTF-8">
  <title>Command Line Tools - MoonScript 0.5.0</title>
  <link rel="stylesheet" href="../reference.css?Fri Feb 27 00:42:27 2026" />
  <script type="text/javascript">
  if (window.location.hostname != "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-136625-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
</head>
<body>
  <div class="header">
    <h1>MoonScript 0.5.0 - Command Line Tools</h1>
  </div>

  <div class="index">
    <div class="column">
      <h3>On This Page</h3>
      <div class="index-list">
        <ul><li><a href="#command-line-tools">Command Line Tools</a></li>
<ul><li><a href="#command-line-tools/moon"><code>moon</code></a></li>
<ul><li><a href="#command-line-tools/moon/error-rewriting">Error Rewriting</a></li>
<li><a href="#command-line-tools/moon/code-coverage">Code Coverage</a></li></ul>
<li><a href="#command-line-tools/moonc"><code>moonc</code></a></li>
<ul><li><a href="#command-line-tools/moonc/syntax-transformer">Syntax Transformer</a></li>
<li><a href="#command-line-tools/moonc/linter">Linter</a></li>
<ul><li><a href="#command-line-tools/moonc/linter/global-variable-checking">Global Variable Checking</a></li>
<li><a href="#command-line-tools/moonc/linter/global-variable-whitelist">Global Variable Whitelist</a></li>
<li><a href="#command-line-tools/moonc/linter/unused-variable-assigns">Unused Variable Assigns</a></li></ul></ul></ul></ul>
      </div>
    </div>

    <div class="column">
      <h3>All Pages</h3>
      <div class="index-list">
        <ul>
          <li><a href="../reference">Language Guide</a></li>
          <li><a href="../reference/standard_lib.html">Standard Library</a></li>
          <li><a href="../reference/command_line.html" class="current">Command Line Tools</a></li>
          <li><a href="../reference/api.html">Compiler API</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="main">
    <h1 id="command-line-tools">Command Line Tools</h1>

<p>Two tools are installed with MoonScript, <code>moon</code> and <code>moonc</code>.</p>

<p><code>moonc</code> is for compiling MoonScript code to Lua.
<code>moon</code> is for running MoonScript code directly.</p>

<h2 id="command-line-tools/moon"><code>moon</code></h2>

<p><code>moon</code> can be used to run MoonScript files directly from the command line,
without needing a separate compile step. All MoonScript files are compiled in
memory as they are executed.</p>

<pre class="highlight lang_bash"><code><span></span>$<span class="w"> </span>moon<span class="w"> </span>my_script.moon</code>
</pre>


<p>Any MoonScript files that are required will also be compiled on demand as they
are loaded.</p>

<p>When an error occurs during runtime, the stack trace is rewritten to give line
numbers from the original <code>.moon</code> file.</p>

<p>If you want to disable <a href="#error_rewriting">error rewriting</a>, you can pass the
<code>-d</code> flag. A full list of flags can be seen by passing the <code>-h</code> or <code>--help</code>
flag.</p>

<h3 id="command-line-tools/moon/error-rewriting">Error Rewriting</h3>

<p>Runtime errors are given special attention when running code using the <code>moon</code>
command line tool. Because code is written in MoonScript but executed as Lua,
errors that happen during runtime report Lua line numbers. This can make
debugging less than ideal.</p>

<p>In order to solve this problem MoonScript builds up a table of line number
mappings, allowing the runtime to calculate what line of MoonScript generated
the line of Lua that triggered the error.</p>

<p>Consider the following file with a bug (note the invalid <code>z</code> variable):</p>

<pre><code class="moon_code"><span></span><span class="n">add_numbers</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="kt">)</span> <span class="nf">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">z</span>  <span class="c1">-- 1</span>
<span class="nb">print</span> <span class="n">add_numbers</span> <span class="mi">10</span><span class="p">,</span><span class="mi">0</span>        <span class="c1">-- 2</span></code>
</pre>


<p>The following error is generated:</p>

<pre><code>moon: scrap.moon:1(3): attempt to perform arithmetic on global 'z' (a nil value)
stack traceback:
  scrap.moon:1(3): in function 'add_numbers'
  scrap.moon:2(5): in main chunk
</code></pre>

<p>Notice how next to the file name there are two numbers. The first number is the
rewritten line number. The number in the parentheses is the original Lua line
number.</p>

<p>The error in this example is being reported on line 1 of the <code>moon</code> file, which
corresponds to line 3 of the generated Lua code. The entire stack trace is rewritten in
addition to the error message.</p>

<h3 id="command-line-tools/moon/code-coverage">Code Coverage</h3>

<p><code>moon</code> lets you run a MoonScript file while keeping track of which lines
are executed with the <code>-c</code> flag.</p>

<p>For example, consider the following <code>.moon</code> file:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="c1">-- test.moon</span>
<span class="n">first</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span>

<span class="n">second</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>

<span class="n">first</span><span class="o">!</span></code></pre></td></tr>
</table>


<p>We can execute and get a glance of which lines ran:</p>

<pre class="highlight lang_bash"><code><span></span>$<span class="w"> </span>moon<span class="w"> </span>-c<span class="w"> </span>test.moon</code>
</pre>


<p>The following output is produced:</p>

<pre><code>------| @cool.moon
     1| -- test.moon
*    2| first = -&gt;
*    3|   print "hello"
     4|
*    5| second = -&gt;
     6|   print "world"
     7|
*    8| first!
     9|
</code></pre>

<p>The star next to the line means that it was executed. Blank lines are not
considered when running so by default they don&rsquo;t get marked as executed.</p>

<h2 id="command-line-tools/moonc"><code>moonc</code></h2>

<p><code>moonc</code> is used for transforming MoonScript files into Lua files.
It takes a list of files, compiles them all, and creates the associated <code>.lua</code>
files in the same directories.</p>

<pre class="highlight lang_bash"><code><span></span>$<span class="w"> </span>moonc<span class="w"> </span>my_script1.moon<span class="w"> </span>my_script2.moon<span class="w"> </span>...</code>
</pre>


<p>You can control where the compiled files are put using the <code>-t</code> flag, followed
by a directory.</p>

<p><code>moonc</code> can also take a directory as an argument, and it will recursively scan
for all MoonScript files and compile them.</p>

<p><code>moonc</code> can write to standard out by passing the <code>-p</code> flag.</p>

<p>The <code>-w</code> flag can be used to enable watch mode. <code>moonc</code> will stay running, and
watch for changes to the input files. If any of them change then they will be
compiled automatically.</p>

<p>A full list of flags can be seen by passing the <code>-h</code> or <code>--help</code> flag.</p>

<h3 id="command-line-tools/moonc/syntax-transformer">Syntax Transformer</h3>

<p>A syntax transformer is a function that manipulates MoonScript code before
compiling to Lua. It operates on the parsed AST (Abstract Syntax Tree). It can
be used to implement macros, change syntax, optimize code, among other things.
You specify the name of a Lua module. This module must return a single function
(or callable object) that takes AST as an argument, and returns the new AST.</p>

<pre class="highlight lang_bash"><code><span></span>moonc<span class="w"> </span>--transform<span class="w"> </span>my_transfomer<span class="w"> </span>my_script.moon</code>
</pre>


<p>The transform can fail by returning <code>nil</code> and an error message. MoonScript AST
is currently undocumented, so you'll have to experiment by printing out the AST
to see how to make changes. MoonScript AST is made up of standard Lua tables
that are nested.</p>

<h3 id="command-line-tools/moonc/linter">Linter</h3>

<p><code>moonc</code> contains a <a href="http://en.wikipedia.org/wiki/Lint_%28software%29">lint</a> tool for statically detecting potential problems
with code. The linter has two tests: detects accessed global variables,
detect unused declared variables. If the linter detects any issues with a file,
the program will exit with a status of <code>1</code>.</p>

<p>You can execute the linter with the <code>-l</code> flag. When the linting flag is
provided only linting takes place and no compiled code is generated.</p>

<p>The linter is compatible with the watch mode (see above) for automatic linting.</p>

<pre class="highlight lang_bash"><code><span></span>moonc<span class="w"> </span>-l<span class="w"> </span>file1.moon<span class="w"> </span>file2.moon</code>
</pre>


<p>Like when compiling, you can also pass a directory as a command line argument
to recursively process all the <code>.moon</code> files.</p>

<h4 id="command-line-tools/moonc/linter/global-variable-checking">Global Variable Checking</h4>

<p>It&rsquo;s considered good practice to avoid using global variables and create local
variables for all the values referenced. A good case for not using global
variables is that you can analyize the code ahead of time without the need to
execute it to find references to undeclared variables.</p>

<p>MoonScript makes it difficult to declare global variables by forcing you to be
explicit with the <code>export</code> keyword, so it&rsquo;s a good candidate for doing this
kind of linting.</p>

<p>Consider the following program with a typo: (<code>my_number</code> is spelled wrong as
<code>my_nmuber</code> in the function)</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="c1">-- lint_example.moon</span>
<span class="n">my_number</span> <span class="o">=</span> <span class="mi">1234</span>

<span class="n">some_function</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="c1">-- a contrived example with a small chance to pass</span>
  <span class="k">if</span> <span class="nb">math.random</span><span class="kt">()</span> <span class="o">&lt;</span> <span class="mf">0.01</span>
    <span class="n">my_nmuber</span> <span class="o">+</span> <span class="mi">10</span>

<span class="n">some_function</span><span class="o">!</span></code></pre></td></tr>
</table>


<p>Although there is a bug in this code, it rarely happens during execution. It&rsquo;s
more likely to be missed during development and cause problems in the future.</p>

<p>Running the linter immediately identifies the problem:</p>

<pre class="highlight lang_bash"><code><span></span>$<span class="w"> </span>moonc<span class="w"> </span>-l<span class="w"> </span>lint_example.moon</code>
</pre>


<p>Outputs:</p>

<pre><code>./lint_example.moon

line 7: accessing global `my_nmuber`
==================================
&gt;       my_nmuber + 10
</code></pre>

<h4 id="command-line-tools/moonc/linter/global-variable-whitelist">Global Variable Whitelist</h4>

<p>In most circumstances it&rsquo;s impossible to avoid using some global variables. For
example, to access any of the built in modules or functions you typically
access them globally.</p>

<p>For this reason a global variable whitelist is used. It&rsquo;s a list of global
variables that are allowed to be used. A default whitelist is provided that
contains all of Lua&rsquo;s built in functions and modules.</p>

<p>You can create your own entires in the whitelist as well. For example, the
testing framework <a href="http://olivinelabs.com/busted">Busted</a> uses a collection of
global functions (like <code>describe</code>, <code>before_each</code>, <code>setup</code>) to make writing
tests easy.</p>

<p>It would be nice if we could allow all of those global functions to be called
for <code>.moon</code> files located in the <code>spec/</code> directory. We can do that by creating
a <code>lint_config</code> file.</p>

<p><code>lint_config</code> is a regular MoonScript or Lua file that provides configuration
for the linter. One of those settings is <code>whitelist_globals</code>.</p>

<p>To create a configuration for Busted we might do something like this:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="c1">-- lint_config.moon</span>
<span class="kt">{</span>
  <span class="nv">whitelist_globals:</span> <span class="kt">{</span>
    <span class="kt">[</span><span class="s2">&quot;</span><span class="s">spec/</span><span class="s2">&quot;</span><span class="kt">]</span><span class="o">:</span> <span class="kt">{</span>
      <span class="s2">&quot;</span><span class="s">it</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">describe</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">setup</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">teardown</span><span class="s2">&quot;</span><span class="p">,</span>
      <span class="s2">&quot;</span><span class="s">before_each</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">after_each</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">pending</span><span class="s2">&quot;</span>
    <span class="kt">}</span>
  <span class="kt">}</span>
<span class="kt">}</span></code></pre></td></tr>
</table>


<p>Compile the file:</p>

<pre class="highlight lang_bash"><code><span></span>$<span class="w"> </span>moonc<span class="w"> </span>lint_config.moon</code>
</pre>


<p>Then run the linter on your entire project:</p>

<pre class="highlight lang_bash"><code><span></span>$<span class="w"> </span>moonc<span class="w"> </span>-l<span class="w"> </span>.</code>
</pre>


<p>The whitelisted global references in <code>spec/</code> will no longer raise notices.</p>

<p>The <code>whitelist_globals</code> property of the <code>lint_config</code> is a table where the keys
are Lua patterns that match file names, and the values are an array of globals
that are allowed.</p>

<p>Multiple patterns in <code>whitelist_globals</code> can match a single file, the union of
the allowed globals will be used when linting that file.</p>

<h4 id="command-line-tools/moonc/linter/unused-variable-assigns">Unused Variable Assigns</h4>

<p>Sometimes when debugging, refactoring, or just developing, you might leave
behind stray assignments that aren&rsquo;t actually necessary for the execution of
your code. It&rsquo;s good practice to clean them up to avoid any potential confusion
they might cause.</p>

<p>The unused assignment detector keeps track of any variables that are assigned,
and if they aren&rsquo;t accessed in within their available scope, they are reported
as an error.</p>

<p>Given the following code:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="nb">print</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">a</span></code></pre></td></tr>
</table>


<p>The linter will identify the problem:</p>

<pre><code>./lint_example.moon

line 1: assigned but unused `b`
===============================
&gt; a, b = 1, 2
</code></pre>

<p>Sometimes you need a name to assign to even though you know it will never be
accessed.  The linter will treat <code>_</code> as a special name that&rsquo;s allowed to be
written to but never accessed:</p>

<p>The following code would not produce any lint errors:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">item</span> <span class="o">=</span> <span class="kt">{</span><span class="mi">123</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">shoe</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">brown</span><span class="s2">&quot;</span><span class="p">,</span> <span class="mi">123</span><span class="kt">}</span>
<span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="n">unpack</span> <span class="n">item</span>
<span class="nb">print</span> <span class="n">name</span><span class="p">,</span> <span class="n">count</span></code></pre></td></tr>
</table>


  </div>

  <div class="footer">Generated on Fri Feb 27 00:42:27 2026; MoonScript v0.5.0</div>
</body>
</html>
