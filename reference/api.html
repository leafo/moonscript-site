<!DOCTYPE HTML>
<html lang="en">
<head>
  <!-- Autogenerated from  on Fri Feb 27 00:42:28 2026 -->
  <meta charset="UTF-8">
  <title>Compiler API - MoonScript 0.5.0</title>
  <link rel="stylesheet" href="../reference.css?Fri Feb 27 00:42:28 2026" />
  <script type="text/javascript">
  if (window.location.hostname != "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-136625-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
</head>
<body>
  <div class="header">
    <h1>MoonScript 0.5.0 - Compiler API</h1>
  </div>

  <div class="index">
    <div class="column">
      <h3>On This Page</h3>
      <div class="index-list">
        <ul><li><a href="#moonscript-compiler-api">MoonScript Compiler API</a></li>
<ul><li><a href="#moonscript-compiler-api/autocompiling-with-the-moonscript-module">Autocompiling with the <code>moonscript</code> Module</a></li>
<li><a href="#moonscript-compiler-api/moonscriptbase-module"><code>moonscript.base</code> Module</a></li>
<li><a href="#moonscript-compiler-api/programmatically-compiling">Programmatically Compiling</a></li></ul></ul>
      </div>
    </div>

    <div class="column">
      <h3>All Pages</h3>
      <div class="index-list">
        <ul>
          <li><a href="../reference">Language Guide</a></li>
          <li><a href="../reference/standard_lib.html">Standard Library</a></li>
          <li><a href="../reference/command_line.html">Command Line Tools</a></li>
          <li><a href="../reference/api.html" class="current">Compiler API</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="main">
    <h1 id="moonscript-compiler-api">MoonScript Compiler API</h1>

<h2 id="moonscript-compiler-api/autocompiling-with-the-moonscript-module">Autocompiling with the <code>moonscript</code> Module</h2>

<p>After installing MoonScript, you can include the <code>moonscript</code> module to make
any Lua script MoonScript aware.</p>

<pre class="highlight lang_lua"><code><span></span><span class="nb">require</span> <span class="s2">&quot;moonscript&quot;</span></code>
</pre>


<p>After <code>moonscript</code> is required, Lua&rsquo;s package loader is updated to search for
<code>.moon</code> files on any subsequent calls to <code>require</code>. The search path for <code>.moon</code>
files is based on the current <code>package.path</code> value in Lua when <code>moonscript</code> is
required. Any search paths in <code>package.path</code> ending in <code>.lua</code> are copied,
rewritten to end in <code>.moon</code>, and then inserted in <code>package.moonpath</code>.</p>

<p>The <code>moonloader</code> is the function that is responsible for searching
<code>package.moonpath</code> for a file available to be included. It is inserted in the
second position of the <code>package.loaders</code> table. This means that a matching <code>.moon</code> file
will be loaded over a matching <code>.lua</code> file that has the same base name.</p>

<p>For more information on Lua&rsquo;s <code>package.loaders</code> see <a href="http://www.lua.org/manual/5.1/manual.html#pdf-package.loaders">Lua Reference Manual
&mdash;
package.loaders</a></p>

<p>The <code>moonloader</code>, when finding a valid path to a <code>.moon</code> file, will parse and
compile the file in memory. The code is then turned into a function using the
built in <code>load</code> function, which is run as the module.</p>

<p>If you are executing MoonScript code with the included <code>moon</code> command line tool
then it is not required to include this module before including any other
MoonScript modules.</p>

<h2 id="moonscript-compiler-api/moonscriptbase-module"><code>moonscript.base</code> Module</h2>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">moonscript</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">moonscript.base</span><span class="s2">&quot;</span></code></pre></td></tr>
</table>


<p>This module contains an assortment of functions for loading and compiling
MoonScript code from within Lua.</p>

<p>The module provides <code>load</code>, <code>loadfile</code>, <code>loadstring</code> functions, which are
analogous to the similarly named Lua functions. The major difference is that
they load MoonScript code instead of Lua code.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">moonscript</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">moonscript.base</span><span class="s2">&quot;</span>

<span class="n">fn</span> <span class="o">=</span> <span class="n">moonscript</span><span class="o">.</span><span class="n">loadstring</span> <span class="s1">&#39;</span><span class="s">print &quot;hi!&quot;</span><span class="s1">&#39;</span>
<span class="n">fn</span><span class="o">!</span></code></pre></td></tr>
</table>


<p>All of these functions can take an optional last argument, a table of options.
The only option right now is <code>implicitly_return_root</code>. Setting this to <code>false</code>
makes it so the file does not implicitly return its last statement.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">moonscript</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">moonscript.base</span><span class="s2">&quot;</span>

<span class="n">fn</span> <span class="o">=</span> <span class="n">moonscript</span><span class="o">.</span><span class="n">loadstring</span> <span class="s2">&quot;</span><span class="s">10</span><span class="s2">&quot;</span>
<span class="nb">print</span> <span class="n">fn</span><span class="o">!</span> <span class="c1">-- prints &quot;10&quot;</span>

<span class="n">fn</span> <span class="o">=</span> <span class="n">moonscript</span><span class="o">.</span><span class="n">loadstring</span> <span class="s2">&quot;</span><span class="s">10</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">implicitly_return_root:</span> <span class="kc">false</span>
<span class="nb">print</span> <span class="n">fn</span><span class="o">!</span> <span class="c1">-- prints nothing</span></code></pre></td></tr>
</table>


<p>One more useful function is provided: <code>to_lua</code>. This function takes a string of
MoonScript code and returns the compiled Lua result along with the line mapping
table. If there are any errors then <code>nil</code> and the error message are returned.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">import</span> <span class="n">to_lua</span> <span class="k">from</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">moonscript.base</span><span class="s2">&quot;</span>

<span class="n">lua_code</span><span class="p">,</span> <span class="n">line_table</span> <span class="o">=</span> <span class="n">to_lua</span> <span class="s">[[</span>
<span class="s">x = 124</span>
<span class="s">print &quot;hello world #{x}&quot;</span>
<span class="s">]]</span></code></pre></td></tr>
</table>


<p>Similar to the <code>load*</code> functions from above, <code>to_lua</code> can take an optional
final argument of a table of options.</p>

<p>The second return value of <code>to_lua</code> is useful if you want to perform line
number reversal. It&rsquo;s a table where the key is a Lua line number and the value
is a character offset from the original MoonScript source.</p>

<h2 id="moonscript-compiler-api/programmatically-compiling">Programmatically Compiling</h2>

<p>If you need finer grained control over the compilation process you can use the
raw parse and compile modules.</p>

<p>Parsing converts a string of MoonScript into an abstract syntax tree. Compiling
converts an abstract syntax tree into a Lua code string.</p>

<p>Knowledge of this API may be useful for creating tools to aid the generation of
Lua code from MoonScript code. For example, you could build a macro system by
analyzing and manipulating the abstract syntax tree. Be warned though, the
format of the abstract syntax tree is undocumented and may change in the
future.</p>

<p>Here is a quick example of how you would compile a MoonScript string to a Lua
String (This is effectively the same as the <code>to_lua</code> function described above):</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">parse</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">moonscript.parse</span><span class="s2">&quot;</span>
<span class="n">compile</span> <span class="o">=</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">moonscript.compile</span><span class="s2">&quot;</span>

<span class="n">moon_code</span> <span class="o">=</span> <span class="s">[[(-&gt; print &quot;hello world&quot;)!]]</span>

<span class="n">tree</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">parse</span><span class="o">.</span><span class="n">string</span> <span class="n">moon_code</span>
<span class="n">unless</span> <span class="n">tree</span>
  <span class="nb">error</span> <span class="s2">&quot;</span><span class="s">Parse error: </span><span class="s2">&quot;</span> <span class="o">..</span> <span class="n">err</span>

<span class="n">lua_code</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">compile</span><span class="o">.</span><span class="n">tree</span> <span class="n">tree</span>
<span class="n">unless</span> <span class="n">lua_code</span>
  <span class="nb">error</span> <span class="n">compile</span><span class="o">.</span><span class="n">format_error</span> <span class="n">err</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">moon_code</span>

<span class="c1">-- our code is ready</span>
<span class="nb">print</span> <span class="n">lua_code</span></code></pre></td></tr>
</table>


  </div>

  <div class="footer">Generated on Fri Feb 27 00:42:28 2026; MoonScript v0.5.0</div>
</body>
</html>
