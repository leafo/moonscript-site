<!DOCTYPE HTML>
<html lang="en">
<head>
  <!-- Autogenerated from  on Fri Feb 27 00:42:15 2026 -->
  <meta charset="UTF-8">
  <title>Language Guide - MoonScript 0.5.0</title>
  <link rel="stylesheet" href="../reference.css?Fri Feb 27 00:42:15 2026" />
  <script type="text/javascript">
  if (window.location.hostname != "localhost") {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-136625-5']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  }
</script>
</head>
<body>
  <div class="header">
    <h1>MoonScript 0.5.0 - Language Guide</h1>
  </div>

  <div class="index">
    <div class="column">
      <h3>On This Page</h3>
      <div class="index-list">
        <ul><li><a href="#the-language">The Language</a></li>
<ul><li><a href="#the-language/whitespace">Whitespace</a></li>
<li><a href="#the-language/assignment">Assignment</a></li>
<li><a href="#the-language/update-assignment">Update Assignment</a></li>
<li><a href="#the-language/comments">Comments</a></li>
<li><a href="#the-language/literals-and-operators">Literals &amp; Operators</a></li>
<li><a href="#the-language/function-literals">Function Literals</a></li>
<ul><li><a href="#the-language/function-literals/fat-arrows">Fat Arrows</a></li>
<li><a href="#the-language/function-literals/argument-defaults">Argument Defaults</a></li>
<li><a href="#the-language/function-literals/considerations">Considerations</a></li>
<li><a href="#the-language/function-literals/multi-line-arguments">Multi-line arguments</a></li></ul>
<li><a href="#the-language/table-literals">Table Literals</a></li>
<li><a href="#the-language/comprehensions">Comprehensions</a></li>
<ul><li><a href="#the-language/comprehensions/list-comprehensions">List Comprehensions</a></li>
<li><a href="#the-language/comprehensions/table-comprehensions">Table Comprehensions</a></li>
<li><a href="#the-language/comprehensions/slicing">Slicing</a></li></ul>
<li><a href="#the-language/string-interpolation">String Interpolation</a></li>
<li><a href="#the-language/for-loop">For Loop</a></li>
<li><a href="#the-language/while-loop">While Loop</a></li>
<li><a href="#the-language/continue">Continue</a></li>
<li><a href="#the-language/conditionals">Conditionals</a></li>
<ul><li><a href="#the-language/conditionals/with-assignment">With Assignment</a></li></ul>
<li><a href="#the-language/line-decorators">Line Decorators</a></li>
<li><a href="#the-language/switch">Switch</a></li>
<li><a href="#the-language/object-oriented-programming">Object Oriented Programming</a></li>
<ul><li><a href="#the-language/object-oriented-programming/inheritance">Inheritance</a></li>
<li><a href="#the-language/object-oriented-programming/super">Super</a></li>
<li><a href="#the-language/object-oriented-programming/types">Types</a></li>
<li><a href="#the-language/object-oriented-programming/class-objects">Class Objects</a></li>
<li><a href="#the-language/object-oriented-programming/class-variables">Class Variables</a></li>
<li><a href="#the-language/object-oriented-programming/class-declaration-statements">Class Declaration Statements</a></li>
<li><a href="#the-language/object-oriented-programming/-and-values"><code>@</code> and <code>@@</code> Values</a></li>
<li><a href="#the-language/object-oriented-programming/class-expressions">Class Expressions</a></li>
<li><a href="#the-language/object-oriented-programming/anonymous-classes">Anonymous classes</a></li></ul>
<li><a href="#the-language/export-statement">Export Statement</a></li>
<ul><li><a href="#the-language/export-statement/export-all-and-export-proper">Export All &amp; Export Proper</a></li></ul>
<li><a href="#the-language/local-statement">Local Statement</a></li>
<li><a href="#the-language/import-statement">Import Statement</a></li>
<li><a href="#the-language/with-statement">With Statement</a></li>
<li><a href="#the-language/do">Do</a></li>
<li><a href="#the-language/destructuring-assignment">Destructuring Assignment</a></li>
<ul><li><a href="#the-language/destructuring-assignment/destructuring-in-other-places">Destructuring In Other Places</a></li></ul>
<li><a href="#the-language/function-stubs">Function Stubs</a></li>
<li><a href="#the-language/the-using-clause-controlling-destructive-assignment">The Using Clause; Controlling Destructive Assignment</a></li>
<li><a href="#the-language/misc">Misc.</a></li>
<ul><li><a href="#the-language/misc/implicit-returns-on-files">Implicit Returns on Files</a></li>
<li><a href="#the-language/misc/writing-modules">Writing Modules</a></li></ul></ul>
<li><a href="#license-mit">License (MIT)</a></li></ul>
      </div>
    </div>

    <div class="column">
      <h3>All Pages</h3>
      <div class="index-list">
        <ul>
          <li><a href="../reference" class="current">Language Guide</a></li>
          <li><a href="../reference/standard_lib.html">Standard Library</a></li>
          <li><a href="../reference/command_line.html">Command Line Tools</a></li>
          <li><a href="../reference/api.html">Compiler API</a></li>
        </ul>
      </div>
    </div>
  </div>

  <div class="main">
    <p>MoonScript is a programming language that compiles to
<a href="http://www.lua.org">Lua</a>. This guide expects the reader to have basic
familiarity with Lua. For each code snippet below, the MoonScript is on the
left and the compiled Lua is on right right.</p>

<p>This is the official language reference manual, installation directions and the
homepage are located at <a href="http://moonscript.org">http://moonscript.org</a>.</p>

<div class="github-buttons">
<iframe src="http://ghbtns.com/github-btn.html?user=leafo&repo=moonscript&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110px" height="20px"></iframe>
<iframe src="http://ghbtns.com/github-btn.html?user=leafo&repo=moonscript&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95px" height="20px"></iframe>
</div>


<h1 id="the-language">The Language</h1>

<h2 id="the-language/whitespace">Whitespace</h2>

<p>MoonScript is a whitespace sensitive language. This means that
instead of using <code>do</code> and <code>end</code> (or <code>{</code> and <code>}</code>) to delimit sections of code we
use line-breaks and indentation.</p>

<p>This means that how you indent your code is important. Luckily MoonScript
doesn&rsquo;t care how you do it but only requires that you be consistent.</p>

<p>An indent must be at least 1 space or 1 tab, but you can use as many as you
like. All the code snippets on this page will use two spaces.</p>

<blockquote><p>Should you happen to mix tabs and spaces, a tab is equivalent to 4 spaces. I
shouldn&rsquo;t be telling you this though because you should never do it.</p></blockquote>

<h2 id="the-language/assignment">Assignment</h2>

<p>Assigning to an undeclared name will cause it to be declared as a new local
variable. The language is dynamically typed so you can assign any value to any
variable. You can assign multiple names and values at once just like Lua:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">hello</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">hello</span> <span class="o">=</span> <span class="mi">123</span> <span class="c1">-- uses the existing variable</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">hello</span> <span class="o">=</span> <span class="s2">&quot;world&quot;</span>
<span class="kd">local</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
<span class="n">hello</span> <span class="o">=</span> <span class="mi">123</span></code></pre></td></tr>
</table>


<p>If you wish to create a global variable it must be done using the
<a href="#export_statement"><code>export</code></a> keyword.</p>

<p>The <a href="#local_statement"><code>local</code></a> keyword can be used to forward declare a
variable, or shadow an existing one.</p>

<h2 id="the-language/update-assignment">Update Assignment</h2>

<p><code>+=</code>, <code>-=</code>, <code>/=</code>, <code>*=</code>, <code>%=</code>, <code>..=</code>, <code>or=</code>, <code>and=</code>, <code>&amp;=</code>, <code>|=</code>, <code>&gt;&gt;=</code>, and
<code>&lt;&lt;=</code> operators have been added for updating and assigning at the same time.
They are aliases for their expanded equivalents.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x</span> <span class="o">+=</span> <span class="mi">10</span>

<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">hello </span><span class="s2">&quot;</span>
<span class="n">s</span> <span class="o">..=</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>

<span class="n">b</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">b</span> <span class="k">and</span><span class="o">=</span> <span class="kc">true</span> <span class="k">or</span> <span class="kc">false</span>

<span class="n">p</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">p</span> <span class="err">&amp;</span><span class="o">=</span> <span class="mi">5</span>
<span class="n">p</span> <span class="err">|</span><span class="o">=</span> <span class="mi">3</span>
<span class="n">p</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span>
<span class="n">p</span> <span class="o">&lt;&lt;=</span> <span class="mi">3</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">10</span>
<span class="kd">local</span> <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;hello &quot;</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">..</span> <span class="s2">&quot;world&quot;</span>
<span class="kd">local</span> <span class="n">b</span> <span class="o">=</span> <span class="kc">false</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">b</span> <span class="ow">and</span> <span class="p">(</span><span class="kc">true</span> <span class="ow">or</span> <span class="kc">false</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">p</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&amp;</span> <span class="mi">5</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">|</span> <span class="mi">3</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span></code></pre></td></tr>
</table>


<h2 id="the-language/comments">Comments</h2>

<p>Like Lua, comments start with <code>--</code> and continue to the end of the line.
Comments are not written to the output.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="c1">-- I am a comment</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span></code></pre></td></tr>
</table>


<h2 id="the-language/literals-and-operators">Literals &amp; Operators</h2>

<p>All of the primitive literals in Lua can be used. This applies to numbers,
strings, booleans, and <code>nil</code>.</p>

<p>All of Lua&rsquo;s binary and unary operators are available. Additionally <code>!=</code> is as
an alias for <code>~=</code>.</p>

<p>Unlike Lua, Line breaks are allowed inside of single and double quote strings
without an escape sequence:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">some_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Here is a string</span>
<span class="s">  that has a line break in it.</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">some_string</span> <span class="o">=</span> <span class="s2">&quot;Here is a string</span><span class="se">\n</span><span class="s2">  that has a line break in it.&quot;</span></code></pre></td></tr>
</table>


<h2 id="the-language/function-literals">Function Literals</h2>

<p>All functions are created using a function expression. A simple function is
denoted using the arrow: <code>-&gt;</code></p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">my_function</span> <span class="o">=</span> <span class="nf">-&gt;</span>
<span class="n">my_function</span><span class="kt">()</span> <span class="c1">-- call the empty function</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">my_function</span>
<span class="n">my_function</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">end</span>
<span class="n">my_function</span><span class="p">()</span></code></pre></td></tr>
</table>


<p>The body of the function can either be one statement placed directly after the
arrow, or it can be a series of statements indented on the following lines:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">func_a</span> <span class="o">=</span> <span class="nf">-&gt;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">hello world</span><span class="s2">&quot;</span>

<span class="n">func_b</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="n">value</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">The value:</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">func_a</span>
<span class="n">func_a</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">func_b</span>
<span class="n">func_b</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The value:&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>If a function has no arguments, it can be called using the <code>!</code> operator,
instead of empty parentheses. The <code>!</code> invocation is the preferred way to call
functions with no arguments.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">func_a</span><span class="o">!</span>
<span class="n">func_b</span><span class="kt">()</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">func_a</span><span class="p">()</span>
<span class="n">func_b</span><span class="p">()</span></code></pre></td></tr>
</table>


<p>Functions with arguments can be created by preceding the arrow with a list of
argument names in parentheses:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">sum</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="kt">)</span> <span class="nf">-&gt;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">sum</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">sum</span>
<span class="n">sum</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Functions can be called by listing the arguments after the name of an expression
that evaluates to a function. When chaining together function calls, the
arguments are applied to the closest function to the left.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">sum</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span>
<span class="nb">print</span> <span class="n">sum</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span>

<span class="n">a</span> <span class="n">b</span> <span class="n">c</span> <span class="s2">&quot;</span><span class="s">a</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">b</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">c</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">sum</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sum</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<span class="n">a</span><span class="p">(</span><span class="n">b</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">)))</span></code></pre></td></tr>
</table>


<p>In order to avoid ambiguity in when calling functions, parentheses can also be
used to surround the arguments. This is required here in order to make sure the
right arguments get sent to the right functions.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nb">print</span> <span class="s2">&quot;</span><span class="s">x:</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="kt">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="kt">)</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">y:</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="kt">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="kt">)</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;x:&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="s2">&quot;y:&quot;</span><span class="p">,</span> <span class="n">sum</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span></code></pre></td></tr>
</table>


<p>There must not be any space between the opening parenthesis and the function.</p>

<p>Functions will coerce the last statement in their body into a return statement,
this is called implicit return:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">sum</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="kt">)</span> <span class="nf">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="nb">print</span> <span class="s2">&quot;</span><span class="s">The sum is </span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">sum</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">sum</span>
<span class="n">sum</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The sum is &quot;</span><span class="p">,</span> <span class="n">sum</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span></code></pre></td></tr>
</table>


<p>And if you need to explicitly return, you can use the <code>return</code> keyword:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">sum</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="kt">)</span> <span class="nf">-&gt;</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">sum</span>
<span class="n">sum</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Just like in Lua, functions can return multiple values. The last statement must
be a list of values separated by commas:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">mystery</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="kt">)</span> <span class="nf">-&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="n">mystery</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">mystery</span>
<span class="n">mystery</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">mystery</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span></code></pre></td></tr>
</table>


<h3 id="the-language/function-literals/fat-arrows">Fat Arrows</h3>

<p>Because it is an idiom in Lua to send an object as the first argument when
calling a method, a special syntax is provided for creating functions which
automatically includes a <code>self</code> argument.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">func</span> <span class="o">=</span> <span class="kt">(</span><span class="n">num</span><span class="kt">)</span> <span class="nf">=&gt;</span> <span class="vc">@value</span> <span class="o">+</span> <span class="n">num</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">func</span>
<span class="n">func</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">self</span><span class="p">.</span><span class="n">value</span> <span class="o">+</span> <span class="n">num</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h3 id="the-language/function-literals/argument-defaults">Argument Defaults</h3>

<p>It is possible to provide default values for the arguments of a function. An
argument is determined to be empty if its value is <code>nil</code>. Any <code>nil</code> arguments
that have a default value will be replaced before the body of the function is run.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">my_function</span> <span class="o">=</span> <span class="kt">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="s">something</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">Hello I am</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">name</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">My height is</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">height</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">my_function</span>
<span class="n">my_function</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="n">height</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="kr">end</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Hello I am&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;My height is&quot;</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>An argument default value expression is evaluated in the body of the function
in the order of the argument declarations. For this reason default values have
access to previously declared arguments.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">some_args</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">1000</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="nb">print</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">some_args</span>
<span class="n">some_args</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">x</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mi">100</span>
  <span class="kr">end</span>
  <span class="kr">if</span> <span class="n">y</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1000</span>
  <span class="kr">end</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h3 id="the-language/function-literals/considerations">Considerations</h3>

<p>Because of the expressive parentheses-less way of calling functions, some
restrictions must be put in place to avoid parsing ambiguity involving
whitespace.</p>

<p>The minus sign plays two roles, a unary negation operator and a binary
subtraction operator. Consider how the following examples compile:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">10</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span><span class="mi">10</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span><span class="n">y</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">x</span><span class="o">-</span> <span class="n">z</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">a</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">10</span>
<span class="kd">local</span> <span class="n">b</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">10</span>
<span class="kd">local</span> <span class="n">c</span> <span class="o">=</span> <span class="n">x</span><span class="p">(</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">d</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">z</span></code></pre></td></tr>
</table>


<p>The precedence of the first argument of a function call can be controlled using
whitespace if the argument is a literal string. In Lua, it is common to leave
off parentheses when calling a function with a single string or table literal.</p>

<p>When there is no space between a variable and a string literal, the
function call takes precedence over any following expressions. No other
arguments can be passed to the function when it is called this way.</p>

<p>Where there is a space following a variable and a string literal, the function
call acts as show above. The string literal belongs to any following
expressions (if they exist), which serves as the argument list.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">func</span><span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="mi">100</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">func</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="mi">100</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">100</span>
<span class="kd">local</span> <span class="n">y</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span></code></pre></td></tr>
</table>


<h3 id="the-language/function-literals/multi-line-arguments">Multi-line arguments</h3>

<p>When calling functions that take a large number of arguments, it is convenient
to split the argument list over multiple lines. Because of the white-space
sensitive nature of the language, care must be taken when splitting up the
argument list.</p>

<p>If an argument list is to be continued onto the next line, the current line
must end in a comma. And the following line must be indented more than the
current indentation. Once indented, all other argument lines must be at the
same level of indentation to be part of the argument list</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">my_func</span> <span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>
  <span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span>

<span class="n">cool_func</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span>
  <span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span>
  <span class="mi">7</span><span class="p">,</span><span class="mi">8</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">my_func</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">cool_func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>This type of invocation can be nested. The level of indentation is used to
determine to which function the arguments belong to.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">my_func</span> <span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span>
  <span class="mi">6</span><span class="p">,</span> <span class="n">another_func</span> <span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
  <span class="mi">5</span><span class="p">,</span><span class="mi">4</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">my_func</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">another_func</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>Because <a href="#table_literals">tables</a> also use the comma as a delimiter, this
indentation syntax is helpful for letting values be part of the argument list
instead of being part of the table.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">x</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span> <span class="n">a_func</span> <span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span>
  <span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span>
<span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span>
  <span class="mi">4</span><span class="p">,</span>
  <span class="n">a_func</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
  <span class="mi">8</span><span class="p">,</span>
  <span class="mi">9</span><span class="p">,</span>
  <span class="mi">10</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>Although uncommon, notice how we can give a deeper indentation for function
arguments if we know we will be using a lower indentation further on.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">y</span> <span class="o">=</span> <span class="kt">{</span> <span class="n">my_func</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>
   <span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span>
  <span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span>
<span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">y</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">my_func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
  <span class="mi">5</span><span class="p">,</span>
  <span class="mi">6</span><span class="p">,</span>
  <span class="mi">7</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>The same thing can be done with other block level statements like
<a href="#conditionals">conditionals</a>. We can use indentation level to determine what
statement a value belongs to:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">if</span> <span class="n">func</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>
  <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span>
  <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">I am inside if</span><span class="s2">&quot;</span>

<span class="k">if</span> <span class="n">func</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">I am inside if</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">if</span> <span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am inside if&quot;</span><span class="p">)</span>
<span class="kr">end</span>
<span class="kr">if</span> <span class="n">func</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am inside if&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h2 id="the-language/table-literals">Table Literals</h2>

<p>Like in Lua, tables are delimited in curly braces.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">some_values</span> <span class="o">=</span> <span class="kt">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">some_values</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span>
  <span class="mi">4</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>Unlike Lua, assigning a value to a key in a table is done with <code>:</code> (instead of
<code>=</code>).</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">some_values</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="nv">name:</span> <span class="s2">&quot;</span><span class="s">Bill</span><span class="s2">&quot;</span><span class="p">,</span>
  <span class="nv">age:</span> <span class="mi">200</span><span class="p">,</span>
  <span class="kt">[</span><span class="s2">&quot;</span><span class="s">favorite food</span><span class="s2">&quot;</span><span class="kt">]</span><span class="o">:</span> <span class="s2">&quot;</span><span class="s">rice</span><span class="s2">&quot;</span>
<span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">some_values</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Bill&quot;</span><span class="p">,</span>
  <span class="n">age</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
  <span class="p">[</span><span class="s2">&quot;favorite food&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;rice&quot;</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>The curly braces can be left off if a single table of key value pairs is being
assigned.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">profile</span> <span class="o">=</span>
  <span class="nv">height:</span> <span class="s2">&quot;</span><span class="s">4 feet</span><span class="s2">&quot;</span><span class="p">,</span>
  <span class="nv">shoe_size:</span> <span class="mi">13</span><span class="p">,</span>
  <span class="nv">favorite_foods:</span> <span class="kt">{</span><span class="s2">&quot;</span><span class="s">ice cream</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">donuts</span><span class="s2">&quot;</span><span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">profile</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">height</span> <span class="o">=</span> <span class="s2">&quot;4 feet&quot;</span><span class="p">,</span>
  <span class="n">shoe_size</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
  <span class="n">favorite_foods</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ice cream&quot;</span><span class="p">,</span>
    <span class="s2">&quot;donuts&quot;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>Newlines can be used to delimit values instead of a comma (or both):</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">values</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>
  <span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span>
  <span class="nv">name:</span> <span class="s2">&quot;</span><span class="s">superman</span><span class="s2">&quot;</span>
  <span class="nv">occupation:</span> <span class="s2">&quot;</span><span class="s">crime fighting</span><span class="s2">&quot;</span>
<span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">values</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span>
  <span class="mi">4</span><span class="p">,</span>
  <span class="mi">5</span><span class="p">,</span>
  <span class="mi">6</span><span class="p">,</span>
  <span class="mi">7</span><span class="p">,</span>
  <span class="mi">8</span><span class="p">,</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;superman&quot;</span><span class="p">,</span>
  <span class="n">occupation</span> <span class="o">=</span> <span class="s2">&quot;crime fighting&quot;</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>When creating a single line table literal, the curly braces can also be left
off:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">my_function</span> <span class="nv">dance:</span> <span class="s2">&quot;</span><span class="s">Tango</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">partner:</span> <span class="s2">&quot;</span><span class="s">none</span><span class="s2">&quot;</span>

<span class="n">y</span> <span class="o">=</span> <span class="nv">type:</span> <span class="s2">&quot;</span><span class="s">dog</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nv">legs:</span> <span class="mi">4</span><span class="p">,</span> <span class="nv">tails:</span> <span class="mi">1</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">my_function</span><span class="p">({</span>
  <span class="n">dance</span> <span class="o">=</span> <span class="s2">&quot;Tango&quot;</span><span class="p">,</span>
  <span class="n">partner</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>
<span class="p">})</span>
<span class="kd">local</span> <span class="n">y</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;dog&quot;</span><span class="p">,</span>
  <span class="n">legs</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
  <span class="n">tails</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>The keys of a table literal can be language keywords without being escaped:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="nv">do:</span> <span class="s2">&quot;</span><span class="s">something</span><span class="s2">&quot;</span>
  <span class="nv">end:</span> <span class="s2">&quot;</span><span class="s">hunger</span><span class="s2">&quot;</span>
<span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">tbl</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;do&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;something&quot;</span><span class="p">,</span>
  <span class="p">[</span><span class="s2">&quot;end&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;hunger&quot;</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>If you are constructing a table out of variables and wish the keys to be the
same as the variable names, then the <code>:</code> prefix operator can be used:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">hair</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">golden</span><span class="s2">&quot;</span>
<span class="n">height</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">person</span> <span class="o">=</span> <span class="kt">{</span> <span class="nv">:hair</span><span class="p">,</span> <span class="nv">:height</span><span class="p">,</span> <span class="nv">shoe_size:</span> <span class="mi">40</span> <span class="kt">}</span>

<span class="n">print_table</span> <span class="nv">:hair</span><span class="p">,</span> <span class="nv">:height</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">hair</span> <span class="o">=</span> <span class="s2">&quot;golden&quot;</span>
<span class="kd">local</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">200</span>
<span class="kd">local</span> <span class="n">person</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">hair</span> <span class="o">=</span> <span class="n">hair</span><span class="p">,</span>
  <span class="n">height</span> <span class="o">=</span> <span class="n">height</span><span class="p">,</span>
  <span class="n">shoe_size</span> <span class="o">=</span> <span class="mi">40</span>
<span class="p">}</span>
<span class="n">print_table</span><span class="p">({</span>
  <span class="n">hair</span> <span class="o">=</span> <span class="n">hair</span><span class="p">,</span>
  <span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
<span class="p">})</span></code></pre></td></tr>
</table>


<p>If you want the key of a field in the table to to be result of an expression,
then you can wrap it in <code>[</code> <code>]</code>, just like in Lua. You can also use a string
literal directly as a key, leaving out the square brackets. This is useful if
your key has any special characters.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">t</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="kt">[</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="kt">]</span><span class="o">:</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span>
  <span class="s2">&quot;</span><span class="s">hello world</span><span class="s2">&quot;</span><span class="o">:</span> <span class="kc">true</span>
<span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">t</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
  <span class="p">[</span><span class="s2">&quot;hello world&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<h2 id="the-language/comprehensions">Comprehensions</h2>

<p>Comprehensions provide a convenient syntax for constructing a new table by
iterating over some existing object and applying an expression to its values.
There are two kinds of comprehensions: list comprehensions and table
comprehensions. They both produce Lua tables; <em>list comprehensions</em> accumulate
values into an array-like table, and <em>table comprehensions</em> let you set both
the key and the value on each iteration.</p>

<h3 id="the-language/comprehensions/list-comprehensions">List Comprehensions</h3>

<p>The following creates a copy of the <code>items</code> table but with all the values
doubled.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">items</span> <span class="o">=</span> <span class="kt">{</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="kt">}</span>
<span class="n">doubled</span> <span class="o">=</span> <span class="kt">[</span><span class="n">item</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="k">in</span> <span class="nb">ipairs</span> <span class="n">items</span><span class="kt">]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">items</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span>
  <span class="mi">4</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">doubled</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">items</span><span class="p">)</span> <span class="kr">do</span>
    <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="kr">end</span>
  <span class="n">doubled</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>The items included in the new table can be restricted with a <code>when</code> clause:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">iter</span> <span class="o">=</span> <span class="nb">ipairs</span> <span class="n">items</span>
<span class="n">slice</span> <span class="o">=</span> <span class="kt">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="k">in</span> <span class="n">iter</span> <span class="k">when</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="kt">]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">iter</span> <span class="o">=</span> <span class="nb">ipairs</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">slice</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kr">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="kr">in</span> <span class="n">iter</span> <span class="kr">do</span>
    <span class="kr">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="kr">then</span>
      <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
      <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="kr">end</span>
  <span class="kr">end</span>
  <span class="n">slice</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Because it is common to iterate over the values of a numerically indexed table,
an <code>*</code> operator is introduced. The doubled example can be rewritten as:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">doubled</span> <span class="o">=</span> <span class="kt">[</span><span class="n">item</span> <span class="o">*</span> <span class="mi">2</span> <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span><span class="kt">]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">doubled</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kd">local</span> <span class="n">_list_0</span> <span class="o">=</span> <span class="n">items</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">_list_0</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">_list_0</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
    <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="kr">end</span>
  <span class="n">doubled</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>The <code>for</code> and <code>when</code> clauses can be chained as much as desired. The only
requirement is that a comprehension has at least one <code>for</code> clause.</p>

<p>Using multiple <code>for</code> clauses is the same as using nested loops:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">x_coords</span> <span class="o">=</span> <span class="kt">{</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="kt">}</span>
<span class="n">y_coords</span> <span class="o">=</span> <span class="kt">{</span><span class="mi">9</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="kt">}</span>

<span class="n">points</span> <span class="o">=</span> <span class="kt">[{</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="kt">}</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="o">*</span><span class="n">x_coords</span> <span class="k">for</span> <span class="n">y</span> <span class="k">in</span> <span class="o">*</span><span class="n">y_coords</span><span class="kt">]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">x_coords</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">4</span><span class="p">,</span>
  <span class="mi">5</span><span class="p">,</span>
  <span class="mi">6</span><span class="p">,</span>
  <span class="mi">7</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">y_coords</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">9</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">points</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">x_coords</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x_coords</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
    <span class="kr">for</span> <span class="n">_index_1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">y_coords</span> <span class="kr">do</span>
      <span class="kd">local</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_coords</span><span class="p">[</span><span class="n">_index_1</span><span class="p">]</span>
      <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">x</span><span class="p">,</span>
        <span class="n">y</span>
      <span class="p">}</span>
      <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="kr">end</span>
  <span class="kr">end</span>
  <span class="n">points</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Numeric for loops can also be used in comprehensions:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">evens</span> <span class="o">=</span> <span class="kt">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span> <span class="k">when</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="kt">]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">evens</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span> <span class="kr">do</span>
    <span class="kr">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
      <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
      <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="kr">end</span>
  <span class="kr">end</span>
  <span class="n">evens</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h3 id="the-language/comprehensions/table-comprehensions">Table Comprehensions</h3>

<p>The syntax for table comprehensions is very similar, only differing by using <code>{</code> and
<code>}</code> and taking two values from each iteration.</p>

<p>This example makes a copy of the table<code>thing</code>:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">thing</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="nv">color:</span> <span class="s2">&quot;</span><span class="s">red</span><span class="s2">&quot;</span>
  <span class="nv">name:</span> <span class="s2">&quot;</span><span class="s">fast</span><span class="s2">&quot;</span>
  <span class="nv">width:</span> <span class="mi">123</span>
<span class="kt">}</span>

<span class="n">thing_copy</span> <span class="o">=</span> <span class="kt">{</span><span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="k">in</span> <span class="nb">pairs</span> <span class="n">thing</span><span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">thing</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span>
  <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;fast&quot;</span><span class="p">,</span>
  <span class="n">width</span> <span class="o">=</span> <span class="mi">123</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">thing_copy</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_tbl_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="kr">do</span>
    <span class="n">_tbl_0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
  <span class="kr">end</span>
  <span class="n">thing_copy</span> <span class="o">=</span> <span class="n">_tbl_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Table comprehensions, like list comprehensions, also support multiple <code>for</code> and
<code>when</code> clauses. In this example we use a <code>when</code> clause to prevent the value
associated with the <code>color</code> key from being copied.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">no_color</span> <span class="o">=</span> <span class="kt">{</span><span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="k">in</span> <span class="nb">pairs</span> <span class="n">thing</span> <span class="k">when</span> <span class="n">k</span> <span class="o">!=</span> <span class="s2">&quot;</span><span class="s">color</span><span class="s2">&quot;</span><span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">no_color</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_tbl_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kr">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">thing</span><span class="p">)</span> <span class="kr">do</span>
    <span class="kr">if</span> <span class="n">k</span> <span class="o">~=</span> <span class="s2">&quot;color&quot;</span> <span class="kr">then</span>
      <span class="n">_tbl_0</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="kr">end</span>
  <span class="kr">end</span>
  <span class="n">no_color</span> <span class="o">=</span> <span class="n">_tbl_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>The <code>*</code> operator is also supported. Here we create a square root look up table
for a few numbers.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">numbers</span> <span class="o">=</span> <span class="kt">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="kt">}</span>
<span class="n">sqrts</span> <span class="o">=</span> <span class="kt">{</span><span class="n">i</span><span class="p">,</span> <span class="nb">math.sqrt</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="o">*</span><span class="n">numbers</span><span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">numbers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span>
  <span class="mi">4</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">sqrts</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_tbl_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">numbers</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="n">numbers</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
    <span class="n">_tbl_0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">math.sqrt</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="kr">end</span>
  <span class="n">sqrts</span> <span class="o">=</span> <span class="n">_tbl_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>The key-value tuple in a table comprehension can also come from a single
expression, in which case the expression should return two values. The
first is used as the key and the second is used as the value:</p>

<p>In this example we convert an array of pairs to a table where the first item in
the pair is the key and the second is the value.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">tuples</span> <span class="o">=</span> <span class="kt">{{</span><span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span><span class="kt">}</span><span class="p">,</span> <span class="kt">{</span><span class="s2">&quot;</span><span class="s">foo</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">bar</span><span class="s2">&quot;</span><span class="kt">}}</span>
<span class="n">tbl</span> <span class="o">=</span> <span class="kt">{</span><span class="n">unpack</span> <span class="n">tuple</span> <span class="k">for</span> <span class="n">tuple</span> <span class="k">in</span> <span class="o">*</span><span class="n">tuples</span><span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">tuples</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span>
    <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
    <span class="s2">&quot;world&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;foo&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bar&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">tbl</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_tbl_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">tuples</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">tuple</span> <span class="o">=</span> <span class="n">tuples</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
    <span class="kd">local</span> <span class="n">_key_0</span><span class="p">,</span> <span class="n">_val_0</span> <span class="o">=</span> <span class="n">unpack</span><span class="p">(</span><span class="n">tuple</span><span class="p">)</span>
    <span class="n">_tbl_0</span><span class="p">[</span><span class="n">_key_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_val_0</span>
  <span class="kr">end</span>
  <span class="n">tbl</span> <span class="o">=</span> <span class="n">_tbl_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h3 id="the-language/comprehensions/slicing">Slicing</h3>

<p>A special syntax is provided to restrict the items that are iterated over when
using the <code>*</code> operator. This is equivalent to setting the iteration bounds and
a step size in a <code>for</code> loop.</p>

<p>Here we can set the minimum and maximum bounds, taking all items with indexes
between 1 and 5 inclusive:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">slice</span> <span class="o">=</span> <span class="kt">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span><span class="kt">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="kt">]]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">slice</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kd">local</span> <span class="n">_list_0</span> <span class="o">=</span> <span class="n">items</span>
  <span class="kd">local</span> <span class="n">_max_0</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">_max_0</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">#</span><span class="n">_list_0</span> <span class="o">+</span> <span class="n">_max_0</span> <span class="ow">or</span> <span class="n">_max_0</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">_list_0</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
    <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
    <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="kr">end</span>
  <span class="n">slice</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Any of the slice arguments can be left off to use a sensible default. In this
example, if the max index is left off it defaults to the length of the table.
This will take everything but the first element:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">slice</span> <span class="o">=</span> <span class="kt">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span><span class="kt">[</span><span class="mi">2</span><span class="p">,</span><span class="kt">]]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">slice</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kd">local</span> <span class="n">_list_0</span> <span class="o">=</span> <span class="n">items</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="o">#</span><span class="n">_list_0</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">_list_0</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
    <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
    <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="kr">end</span>
  <span class="n">slice</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>If the minimum bound is left out, it defaults to 1. Here we only provide a step
size and leave the other bounds blank. This takes all odd indexed items: (1, 3,
5, &hellip;)</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">slice</span> <span class="o">=</span> <span class="kt">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span><span class="kt">[</span><span class="p">,,</span><span class="mi">2</span><span class="kt">]]</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">slice</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kd">local</span> <span class="n">_list_0</span> <span class="o">=</span> <span class="n">items</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">_list_0</span><span class="p">,</span> <span class="mi">2</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">_list_0</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
    <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
    <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="kr">end</span>
  <span class="n">slice</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h2 id="the-language/string-interpolation">String Interpolation</h2>

<p>You can mix expressions into string literals using <code>#{}</code> syntax.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nb">print</span> <span class="s2">&quot;</span><span class="s">I am #{math.random! * 100}% sure.</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I am &quot;</span> <span class="o">..</span> <span class="nb">tostring</span><span class="p">(</span><span class="nb">math.random</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">..</span> <span class="s2">&quot;% sure.&quot;</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>String interpolation is only available in double quoted strings.</p>

<h2 id="the-language/for-loop">For Loop</h2>

<p>There are two for loop forms, just like in Lua. A numeric one and a generic one:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span>
  <span class="nb">print</span> <span class="n">i</span>

<span class="k">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">2</span> <span class="c1">-- an optional step provided</span>
  <span class="nb">print</span> <span class="n">k</span>

<span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="k">in</span> <span class="nb">pairs</span> <span class="n">object</span>
  <span class="nb">print</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span> <span class="kr">do</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="kr">end</span>
<span class="kr">for</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">2</span> <span class="kr">do</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<span class="kr">end</span>
<span class="kr">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="kr">in</span> <span class="nb">pairs</span><span class="p">(</span><span class="n">object</span><span class="p">)</span> <span class="kr">do</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>The slicing and <code>*</code> operators can be used, just like with comprehensions:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span><span class="kt">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="kt">]</span>
  <span class="nb">print</span> <span class="n">item</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">_list_0</span> <span class="o">=</span> <span class="n">items</span>
<span class="kd">local</span> <span class="n">_max_0</span> <span class="o">=</span> <span class="mi">4</span>
<span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">_max_0</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="o">#</span><span class="n">_list_0</span> <span class="o">+</span> <span class="n">_max_0</span> <span class="ow">or</span> <span class="n">_max_0</span> <span class="kr">do</span>
  <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">_list_0</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>A shorter syntax is also available for all variations when the body is only a
single line:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span> <span class="k">do</span> <span class="nb">print</span> <span class="n">item</span>

<span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">3</span> <span class="k">do</span> <span class="nb">print</span> <span class="n">j</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">_list_0</span> <span class="o">=</span> <span class="n">items</span>
<span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">_list_0</span> <span class="kr">do</span>
  <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">_list_0</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="kr">end</span>
<span class="kr">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">3</span> <span class="kr">do</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>A for loop can also be used as an expression. The last statement in the body of
the for loop is coerced into an expression and appended to an accumulating
array table.</p>

<p>Doubling every even number:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">doubled_evens</span> <span class="o">=</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span>
  <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">else</span>
    <span class="n">i</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">doubled_evens</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span> <span class="kr">do</span>
    <span class="kr">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
      <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="kr">else</span>
      <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
    <span class="kr">end</span>
    <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
  <span class="kr">end</span>
  <span class="n">doubled_evens</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>You can also filter values by combining the for loop expression with the
<a href="#continue"><code>continue</code></a> statement.</p>

<p>For loops at the end of a function body are not accumulated into a table for a
return value (Instead the function will return <code>nil</code>). Either an explicit
<code>return</code> statement can be used, or the loop can be converted into a list
comprehension.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">func_a</span> <span class="o">=</span> <span class="nf">-&gt;</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span> <span class="k">do</span> <span class="n">i</span>
<span class="n">func_b</span> <span class="o">=</span> <span class="nf">-&gt;</span> <span class="k">return</span> <span class="k">for</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span> <span class="k">do</span> <span class="n">i</span>

<span class="nb">print</span> <span class="n">func_a</span><span class="o">!</span> <span class="c1">-- prints nil</span>
<span class="nb">print</span> <span class="n">func_b</span><span class="o">!</span> <span class="c1">-- prints table object</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">func_a</span>
<span class="n">func_a</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">_</span> <span class="o">=</span> <span class="n">i</span>
  <span class="kr">end</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">func_b</span>
<span class="n">func_b</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">return</span> <span class="p">(</span><span class="kr">function</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
    <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="kr">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span> <span class="kr">do</span>
      <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
      <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="kr">end</span>
    <span class="kr">return</span> <span class="n">_accum_0</span>
  <span class="kr">end</span><span class="p">)()</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func_a</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func_b</span><span class="p">())</span></code></pre></td></tr>
</table>


<p>This is done to avoid the needless creation of tables for functions that don&rsquo;t
need to return the results of the loop.</p>

<h2 id="the-language/while-loop">While Loop</h2>

<p>The while loop also comes in two variations:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
  <span class="nb">print</span> <span class="n">i</span>
  <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="k">while</span> <span class="n">running</span> <span class="o">==</span> <span class="kc">true</span> <span class="k">do</span> <span class="n">my_function</span><span class="o">!</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kr">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">do</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
<span class="kr">end</span>
<span class="kr">while</span> <span class="n">running</span> <span class="o">==</span> <span class="kc">true</span> <span class="kr">do</span>
  <span class="n">my_function</span><span class="p">()</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Like for loops, the while loop can also be used an expression. Additionally,
for a function to return the accumulated value of a while loop, the statement
must be explicitly returned.</p>

<h2 id="the-language/continue">Continue</h2>

<p>A <code>continue</code> statement can be used to skip the current iteration in a loop.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span>
  <span class="n">continue</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="nb">print</span> <span class="n">i</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="kr">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_continue_0</span> <span class="o">=</span> <span class="kc">false</span>
  <span class="kr">repeat</span>
    <span class="kr">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="kr">then</span>
      <span class="n">_continue_0</span> <span class="o">=</span> <span class="kc">true</span>
      <span class="kr">break</span>
    <span class="kr">end</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">_continue_0</span> <span class="o">=</span> <span class="kc">true</span>
  <span class="kr">until</span> <span class="kc">true</span>
  <span class="kr">if</span> <span class="ow">not</span> <span class="n">_continue_0</span> <span class="kr">then</span>
    <span class="kr">break</span>
  <span class="kr">end</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p><code>continue</code> can also be used with loop expressions to prevent that iteration
from accumulating into the result. This examples filters the array table into
just even numbers:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">my_numbers</span> <span class="o">=</span> <span class="kt">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="kt">}</span>
<span class="n">odds</span> <span class="o">=</span> <span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="o">*</span><span class="n">my_numbers</span>
  <span class="n">continue</span> <span class="k">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="n">x</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">my_numbers</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="mi">2</span><span class="p">,</span>
  <span class="mi">3</span><span class="p">,</span>
  <span class="mi">4</span><span class="p">,</span>
  <span class="mi">5</span><span class="p">,</span>
  <span class="mi">6</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">odds</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_accum_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="kd">local</span> <span class="n">_len_0</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">my_numbers</span> <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">_continue_0</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="kr">repeat</span>
      <span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="n">my_numbers</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
      <span class="kr">if</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="kr">then</span>
        <span class="n">_continue_0</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="kr">break</span>
      <span class="kr">end</span>
      <span class="kd">local</span> <span class="n">_value_0</span> <span class="o">=</span> <span class="n">x</span>
      <span class="n">_accum_0</span><span class="p">[</span><span class="n">_len_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">_value_0</span>
      <span class="n">_len_0</span> <span class="o">=</span> <span class="n">_len_0</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="n">_continue_0</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="kr">until</span> <span class="kc">true</span>
    <span class="kr">if</span> <span class="ow">not</span> <span class="n">_continue_0</span> <span class="kr">then</span>
      <span class="kr">break</span>
    <span class="kr">end</span>
  <span class="kr">end</span>
  <span class="n">odds</span> <span class="o">=</span> <span class="n">_accum_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h2 id="the-language/conditionals">Conditionals</h2>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">have_coins</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">if</span> <span class="n">have_coins</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">Got coins</span><span class="s2">&quot;</span>
<span class="k">else</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">No coins</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">have_coins</span> <span class="o">=</span> <span class="kc">false</span>
<span class="kr">if</span> <span class="n">have_coins</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Got coins&quot;</span><span class="p">)</span>
<span class="kr">else</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No coins&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>A short syntax for single statements can also be used:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">have_coins</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">if</span> <span class="n">have_coins</span> <span class="k">then</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">Got coins</span><span class="s2">&quot;</span> <span class="k">else</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">No coins</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">have_coins</span> <span class="o">=</span> <span class="kc">false</span>
<span class="kr">if</span> <span class="n">have_coins</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Got coins&quot;</span><span class="p">)</span>
<span class="kr">else</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No coins&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Because if statements can be used as expressions, this can also be written as:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">have_coins</span> <span class="o">=</span> <span class="kc">false</span>
<span class="nb">print</span> <span class="k">if</span> <span class="n">have_coins</span> <span class="k">then</span> <span class="s2">&quot;</span><span class="s">Got coins</span><span class="s2">&quot;</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="s">No coins</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">have_coins</span> <span class="o">=</span> <span class="kc">false</span>
<span class="nb">print</span><span class="p">((</span><span class="kr">function</span><span class="p">()</span>
  <span class="kr">if</span> <span class="n">have_coins</span> <span class="kr">then</span>
    <span class="kr">return</span> <span class="s2">&quot;Got coins&quot;</span>
  <span class="kr">else</span>
    <span class="kr">return</span> <span class="s2">&quot;No coins&quot;</span>
  <span class="kr">end</span>
<span class="kr">end</span><span class="p">)())</span></code></pre></td></tr>
</table>


<p>Conditionals can also be used in return statements and assignments:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">is_tall</span> <span class="o">=</span> <span class="kt">(</span><span class="n">name</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="s">Rob</span><span class="s2">&quot;</span>
    <span class="kc">true</span>
  <span class="k">else</span>
    <span class="kc">false</span>

<span class="n">message</span> <span class="o">=</span> <span class="k">if</span> <span class="n">is_tall</span> <span class="s2">&quot;</span><span class="s">Rob</span><span class="s2">&quot;</span>
  <span class="s2">&quot;</span><span class="s">I am very tall</span><span class="s2">&quot;</span>
<span class="k">else</span>
  <span class="s2">&quot;</span><span class="s">I am not so tall</span><span class="s2">&quot;</span>

<span class="nb">print</span> <span class="n">message</span> <span class="c1">-- prints: I am very tall</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">is_tall</span>
<span class="n">is_tall</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Rob&quot;</span> <span class="kr">then</span>
    <span class="kr">return</span> <span class="kc">true</span>
  <span class="kr">else</span>
    <span class="kr">return</span> <span class="kc">false</span>
  <span class="kr">end</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">message</span>
<span class="kr">if</span> <span class="n">is_tall</span><span class="p">(</span><span class="s2">&quot;Rob&quot;</span><span class="p">)</span> <span class="kr">then</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;I am very tall&quot;</span>
<span class="kr">else</span>
  <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;I am not so tall&quot;</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>The opposite of <code>if</code> is <code>unless</code>:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">unless</span> <span class="nb">os.date</span><span class="kt">(</span><span class="s2">&quot;</span><span class="s">%A</span><span class="s2">&quot;</span><span class="kt">)</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="s">Monday</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">it is not Monday!</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">os.date</span><span class="p">(</span><span class="s2">&quot;%A&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;Monday&quot;</span><span class="p">)</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;it is not Monday!&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nb">print</span> <span class="s2">&quot;</span><span class="s">You&#39;re lucky!</span><span class="s2">&quot;</span> <span class="n">unless</span> <span class="nb">math.random</span><span class="o">!</span> <span class="o">&gt;</span> <span class="mf">0.1</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">if</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">math.random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">)</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You&#39;re lucky!&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h3 id="the-language/conditionals/with-assignment">With Assignment</h3>

<p><code>if</code> and <code>elseif</code> blocks can take an assignment in place of a conditional
expression. Upon evaluating the conditional, the assignment will take place and
the value that was assigned to will be used as the conditional expression. The
assigned variable is only in scope for the body of the conditional, meaning it
is never available if the value is not truthy.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">if</span> <span class="n">user</span> <span class="o">=</span> <span class="n">database</span><span class="o">.</span><span class="n">find_user</span> <span class="s2">&quot;</span><span class="s">moon</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">do</span>
  <span class="kd">local</span> <span class="n">user</span> <span class="o">=</span> <span class="n">database</span><span class="p">.</span><span class="n">find_user</span><span class="p">(</span><span class="s2">&quot;moon&quot;</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">user</span> <span class="kr">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">user</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
  <span class="kr">end</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">if</span> <span class="n">hello</span> <span class="o">=</span> <span class="nb">os.getenv</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">You have hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">hello</span>
<span class="k">elseif</span> <span class="n">world</span> <span class="o">=</span> <span class="nb">os.getenv</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">you have world</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">world</span>
<span class="k">else</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">nothing :(</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">do</span>
  <span class="kd">local</span> <span class="n">hello</span> <span class="o">=</span> <span class="nb">os.getenv</span><span class="p">(</span><span class="s2">&quot;hello&quot;</span><span class="p">)</span>
  <span class="kr">if</span> <span class="n">hello</span> <span class="kr">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You have hello&quot;</span><span class="p">,</span> <span class="n">hello</span><span class="p">)</span>
  <span class="kr">else</span>
    <span class="kr">do</span>
      <span class="kd">local</span> <span class="n">world</span> <span class="o">=</span> <span class="nb">os.getenv</span><span class="p">(</span><span class="s2">&quot;world&quot;</span><span class="p">)</span>
      <span class="kr">if</span> <span class="n">world</span> <span class="kr">then</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;you have world&quot;</span><span class="p">,</span> <span class="n">world</span><span class="p">)</span>
      <span class="kr">else</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nothing :(&quot;</span><span class="p">)</span>
      <span class="kr">end</span>
    <span class="kr">end</span>
  <span class="kr">end</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h2 id="the-language/line-decorators">Line Decorators</h2>

<p>For convenience, the for loop and if statement can be applied to single
statements at the end of the line:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nb">print</span> <span class="s2">&quot;</span><span class="s">hello world</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="s">Rob</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;Rob&quot;</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;hello world&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>And with basic loops:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nb">print</span> <span class="s2">&quot;</span><span class="s">item: </span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">items</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">_list_0</span> <span class="o">=</span> <span class="n">items</span>
<span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">_list_0</span> <span class="kr">do</span>
  <span class="kd">local</span> <span class="n">item</span> <span class="o">=</span> <span class="n">_list_0</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;item: &quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h2 id="the-language/switch">Switch</h2>

<p>The switch statement is shorthand for writing a series of if statements that
check against the same value. Note that the value is only evaluated once. Like
if statements, switches can have an else block to handle no matches. Comparison
is done with the <code>==</code> operator.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Dan</span><span class="s2">&quot;</span>
<span class="k">switch</span> <span class="n">name</span>
  <span class="k">when</span> <span class="s2">&quot;</span><span class="s">Robert</span><span class="s2">&quot;</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">You are Robert</span><span class="s2">&quot;</span>
  <span class="k">when</span> <span class="s2">&quot;</span><span class="s">Dan</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">Daniel</span><span class="s2">&quot;</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">Your name, it&#39;s Dan</span><span class="s2">&quot;</span>
  <span class="k">else</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">I don&#39;t know about your name</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Dan&quot;</span>
<span class="kd">local</span> <span class="n">_exp_0</span> <span class="o">=</span> <span class="n">name</span>
<span class="kr">if</span> <span class="s2">&quot;Robert&quot;</span> <span class="o">==</span> <span class="n">_exp_0</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You are Robert&quot;</span><span class="p">)</span>
<span class="kr">elseif</span> <span class="s2">&quot;Dan&quot;</span> <span class="o">==</span> <span class="n">_exp_0</span> <span class="ow">or</span> <span class="s2">&quot;Daniel&quot;</span> <span class="o">==</span> <span class="n">_exp_0</span> <span class="kr">then</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Your name, it&#39;s Dan&quot;</span><span class="p">)</span>
<span class="kr">else</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;I don&#39;t know about your name&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>A switch <code>when</code> clause can match against multiple values by listing them out
comma separated.</p>

<p>Switches can be used as expressions as well, here we can assign the result of
the switch to a variable:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">next_number</span> <span class="o">=</span> <span class="k">switch</span> <span class="n">b</span>
  <span class="k">when</span> <span class="mi">1</span>
    <span class="mi">2</span>
  <span class="k">when</span> <span class="mi">2</span>
    <span class="mi">3</span>
  <span class="k">else</span>
    <span class="nb">error</span> <span class="s2">&quot;</span><span class="s">can&#39;t count that high!</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
<span class="kd">local</span> <span class="n">next_number</span>
<span class="kd">local</span> <span class="n">_exp_0</span> <span class="o">=</span> <span class="n">b</span>
<span class="kr">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">_exp_0</span> <span class="kr">then</span>
  <span class="n">next_number</span> <span class="o">=</span> <span class="mi">2</span>
<span class="kr">elseif</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">_exp_0</span> <span class="kr">then</span>
  <span class="n">next_number</span> <span class="o">=</span> <span class="mi">3</span>
<span class="kr">else</span>
  <span class="n">next_number</span> <span class="o">=</span> <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;can&#39;t count that high!&quot;</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>We can use the <code>then</code> keyword to write a switch&rsquo;s <code>when</code> block on a single line.
No extra keyword is needed to write the else block on a single line.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">msg</span> <span class="o">=</span> <span class="k">switch</span> <span class="nb">math.random</span><span class="kt">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="kt">)</span>
  <span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="s2">&quot;</span><span class="s">you are lucky</span><span class="s2">&quot;</span>
  <span class="k">when</span> <span class="mi">2</span> <span class="k">then</span> <span class="s2">&quot;</span><span class="s">you are almost lucky</span><span class="s2">&quot;</span>
  <span class="k">else</span> <span class="s2">&quot;</span><span class="s">not so lucky</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">msg</span>
<span class="kd">local</span> <span class="n">_exp_0</span> <span class="o">=</span> <span class="nb">math.random</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="kr">if</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">_exp_0</span> <span class="kr">then</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;you are lucky&quot;</span>
<span class="kr">elseif</span> <span class="mi">2</span> <span class="o">==</span> <span class="n">_exp_0</span> <span class="kr">then</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;you are almost lucky&quot;</span>
<span class="kr">else</span>
  <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;not so lucky&quot;</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>It is worth noting the order of the case comparison expression. The case&rsquo;s
expression is on the left hand side. This can be useful if the case&rsquo;s
expression wants to overwrite how the comparison is done by defining an <code>eq</code>
metamethod.</p>

<h2 id="the-language/object-oriented-programming">Object Oriented Programming</h2>

<p>In these examples, the generated Lua code may appear overwhelming. It is best
to focus on the meaning of the MoonScript code at first, then look into the Lua
code if you wish to know the implementation details.</p>

<p>A simple class:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">Inventory</span>
  <span class="nv">new:</span> <span class="nf">=&gt;</span>
    <span class="vc">@items</span> <span class="o">=</span> <span class="kt">{}</span>

  <span class="nv">add_item:</span> <span class="kt">(</span><span class="n">name</span><span class="kt">)</span> <span class="nf">=&gt;</span>
    <span class="k">if</span> <span class="vc">@items</span><span class="kt">[</span><span class="n">name</span><span class="kt">]</span>
      <span class="vc">@items</span><span class="kt">[</span><span class="n">name</span><span class="kt">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">else</span>
      <span class="vc">@items</span><span class="kt">[</span><span class="n">name</span><span class="kt">]</span> <span class="o">=</span> <span class="mi">1</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">Inventory</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_class_0</span>
  <span class="kd">local</span> <span class="n">_base_0</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">add_item</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="kr">if</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="kr">then</span>
        <span class="kd">local</span> <span class="n">_update_0</span> <span class="o">=</span> <span class="n">name</span>
        <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">_update_0</span><span class="p">]</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">_update_0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
      <span class="kr">else</span>
        <span class="n">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="kr">end</span>
    <span class="kr">end</span>
  <span class="p">}</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">_base_0</span>
  <span class="n">_class_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({</span>
    <span class="n">__init</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
      <span class="n">self</span><span class="p">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">__base</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">,</span>
    <span class="n">__name</span> <span class="o">=</span> <span class="s2">&quot;Inventory&quot;</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="n">__index</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">,</span>
    <span class="n">__call</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kd">local</span> <span class="n">_self_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({},</span> <span class="n">_base_0</span><span class="p">)</span>
      <span class="n">cls</span><span class="p">.</span><span class="n">__init</span><span class="p">(</span><span class="n">_self_0</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kr">return</span> <span class="n">_self_0</span>
    <span class="kr">end</span>
  <span class="p">})</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__class</span> <span class="o">=</span> <span class="n">_class_0</span>
  <span class="n">Inventory</span> <span class="o">=</span> <span class="n">_class_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>A class is declared with a <code>class</code> statement followed by a table-like
declaration where all of the methods and properties are listed.</p>

<p>The <code>new</code> property is special in that it will become the constructor.</p>

<p>Notice how all the methods in the class use the fat arrow function syntax. When
calling methods on a instance, the instance itself is sent in as the first
argument. The fat arrow handles the creation of a <code>self</code> argument.</p>

<p>The <code>@</code> prefix on a variable name is shorthand for <code>self.</code>. <code>@items</code> becomes
<code>self.items</code>.</p>

<p>Creating an instance of the class is done by calling the name of the class as a
function.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">inv</span> <span class="o">=</span> <span class="nc">Inventory</span><span class="o">!</span>
<span class="n">inv</span><span class="o">\</span><span class="n">add_item</span> <span class="s2">&quot;</span><span class="s">t-shirt</span><span class="s2">&quot;</span>
<span class="n">inv</span><span class="o">\</span><span class="n">add_item</span> <span class="s2">&quot;</span><span class="s">pants</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">inv</span> <span class="o">=</span> <span class="n">Inventory</span><span class="p">()</span>
<span class="n">inv</span><span class="p">:</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;t-shirt&quot;</span><span class="p">)</span>
<span class="n">inv</span><span class="p">:</span><span class="n">add_item</span><span class="p">(</span><span class="s2">&quot;pants&quot;</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>Because the instance of the class needs to be sent to the methods when they are
called, the <code>\</code> operator is used.</p>

<p>All properties of a class are shared among the instances. This is fine for
functions, but for other types of objects, undesired results may occur.</p>

<p>Consider the example below, the <code>clothes</code> property is shared amongst all
instances, so modifications to it in one instance will show up in another:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="nv">clothes:</span> <span class="kt">{}</span>
  <span class="nv">give_item:</span> <span class="kt">(</span><span class="n">name</span><span class="kt">)</span> <span class="nf">=&gt;</span>
    <span class="nb">table.insert</span> <span class="vc">@clothes</span><span class="p">,</span> <span class="n">name</span>

<span class="n">a</span> <span class="o">=</span> <span class="nc">Person</span><span class="o">!</span>
<span class="n">b</span> <span class="o">=</span> <span class="nc">Person</span><span class="o">!</span>

<span class="n">a</span><span class="o">\</span><span class="n">give_item</span> <span class="s2">&quot;</span><span class="s">pants</span><span class="s2">&quot;</span>
<span class="n">b</span><span class="o">\</span><span class="n">give_item</span> <span class="s2">&quot;</span><span class="s">shirt</span><span class="s2">&quot;</span>

<span class="c1">-- will print both pants and shirt</span>
<span class="nb">print</span> <span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="k">in</span> <span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">clothes</span></code></pre></td></tr>
</table>


<p>The proper way to avoid this problem is to create the mutable state of the
object in the constructor:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">Person</span>
  <span class="nv">new:</span> <span class="nf">=&gt;</span>
    <span class="vc">@clothes</span> <span class="o">=</span> <span class="kt">{}</span></code></pre></td></tr>
</table>


<h3 id="the-language/object-oriented-programming/inheritance">Inheritance</h3>

<p>The <code>extends</code> keyword can be used in a class declaration to inherit the
properties and methods from another class.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">BackPack</span> <span class="k">extends</span> <span class="nc">Inventory</span>
  <span class="nv">size:</span> <span class="mi">10</span>
  <span class="nv">add_item:</span> <span class="kt">(</span><span class="n">name</span><span class="kt">)</span> <span class="nf">=&gt;</span>
    <span class="k">if</span> <span class="o">#</span><span class="vc">@items</span> <span class="o">&gt;</span> <span class="n">size</span> <span class="k">then</span> <span class="nb">error</span> <span class="s2">&quot;</span><span class="s">backpack is full</span><span class="s2">&quot;</span>
    <span class="k">super</span> <span class="n">name</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">BackPack</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_class_0</span>
  <span class="kd">local</span> <span class="n">_parent_0</span> <span class="o">=</span> <span class="n">Inventory</span>
  <span class="kd">local</span> <span class="n">_base_0</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">add_item</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="kr">if</span> <span class="o">#</span><span class="n">self</span><span class="p">.</span><span class="n">items</span> <span class="o">&gt;</span> <span class="n">size</span> <span class="kr">then</span>
        <span class="nb">error</span><span class="p">(</span><span class="s2">&quot;backpack is full&quot;</span><span class="p">)</span>
      <span class="kr">end</span>
      <span class="kr">return</span> <span class="n">_class_0</span><span class="p">.</span><span class="n">__parent</span><span class="p">.</span><span class="n">__base</span><span class="p">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="kr">end</span>
  <span class="p">}</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">_base_0</span>
  <span class="nb">setmetatable</span><span class="p">(</span><span class="n">_base_0</span><span class="p">,</span> <span class="n">_parent_0</span><span class="p">.</span><span class="n">__base</span><span class="p">)</span>
  <span class="n">_class_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({</span>
    <span class="n">__init</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kr">return</span> <span class="n">_class_0</span><span class="p">.</span><span class="n">__parent</span><span class="p">.</span><span class="n">__init</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="p">...)</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">__base</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">,</span>
    <span class="n">__name</span> <span class="o">=</span> <span class="s2">&quot;BackPack&quot;</span><span class="p">,</span>
    <span class="n">__parent</span> <span class="o">=</span> <span class="n">_parent_0</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="n">__index</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="kd">local</span> <span class="n">val</span> <span class="o">=</span> <span class="nb">rawget</span><span class="p">(</span><span class="n">_base_0</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="kr">if</span> <span class="n">val</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
        <span class="kd">local</span> <span class="n">parent</span> <span class="o">=</span> <span class="nb">rawget</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s2">&quot;__parent&quot;</span><span class="p">)</span>
        <span class="kr">if</span> <span class="n">parent</span> <span class="kr">then</span>
          <span class="kr">return</span> <span class="n">parent</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="kr">end</span>
      <span class="kr">else</span>
        <span class="kr">return</span> <span class="n">val</span>
      <span class="kr">end</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">__call</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kd">local</span> <span class="n">_self_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({},</span> <span class="n">_base_0</span><span class="p">)</span>
      <span class="n">cls</span><span class="p">.</span><span class="n">__init</span><span class="p">(</span><span class="n">_self_0</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kr">return</span> <span class="n">_self_0</span>
    <span class="kr">end</span>
  <span class="p">})</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__class</span> <span class="o">=</span> <span class="n">_class_0</span>
  <span class="kr">if</span> <span class="n">_parent_0</span><span class="p">.</span><span class="n">__inherited</span> <span class="kr">then</span>
    <span class="n">_parent_0</span><span class="p">.</span><span class="n">__inherited</span><span class="p">(</span><span class="n">_parent_0</span><span class="p">,</span> <span class="n">_class_0</span><span class="p">)</span>
  <span class="kr">end</span>
  <span class="n">BackPack</span> <span class="o">=</span> <span class="n">_class_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Here we extend our Inventory class, and limit the amount of items it can carry.</p>

<p>In this example, we don&rsquo;t define a constructor on the subclass, so the parent
class' constructor is called when we make a new instance. If we did define a
constructor then we can use the <a href="#super"><code>super</code></a> method to call the parent
constructor.</p>

<p>Whenever a class inherits from another, it sends a message to the parent class
by calling the method <code>__inherited</code> on the parent class if it exists. The
function receives two arguments, the class that is being inherited and the
child class.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">Shelf</span>
  <span class="vc">@__inherited</span><span class="o">:</span> <span class="kt">(</span><span class="n">child</span><span class="kt">)</span> <span class="nf">=&gt;</span>
    <span class="nb">print</span> <span class="vc">@__name</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">was inherited by</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">child</span><span class="o">.</span><span class="n">__name</span>

<span class="c1">-- will print: Shelf was inherited by Cupboard</span>
<span class="k">class</span> <span class="nc">Cupboard</span> <span class="k">extends</span> <span class="nc">Shelf</span></code></pre></td></tr>
</table>


<h3 id="the-language/object-oriented-programming/super">Super</h3>

<p><code>super</code> is a special keyword that can be used in two different ways: It can be
treated as an object, or it can be called like a function. It only has special
functionality when inside a class.</p>

<p>When called as a function, it will call the function of the same name in the
parent class. The current <code>self</code> will automatically be passed as the first
argument. (As seen in the <a href="#inheritance">inheritance</a> example above)</p>

<p>When <code>super</code> is used as a normal value, it is a reference to the parent class
object.</p>

<p>It can be accessed like any of object in order to retrieve values in the
parent class that might have been shadowed by the child class.</p>

<p>When the <code>\</code> calling operator is used with <code>super</code>, <code>self</code> is inserted as the
first argument instead of the value of <code>super</code> itself. When using <code>.</code> to
retrieve a function, the raw function is returned.</p>

<p>A few examples of using <code>super</code> in different ways:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">MyClass</span> <span class="k">extends</span> <span class="nc">ParentClass</span>
  <span class="nv">a_method:</span> <span class="nf">=&gt;</span>
    <span class="c1">-- the following have the same effect:</span>
    <span class="k">super</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>
    <span class="k">super</span><span class="o">\</span><span class="n">a_method</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>
    <span class="k">super</span><span class="o">.</span><span class="n">a_method</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>

    <span class="c1">-- super as a value is equal to the parent class:</span>
    <span class="nb">assert</span> <span class="k">super</span> <span class="o">==</span> <span class="nc">ParentClass</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">MyClass</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_class_0</span>
  <span class="kd">local</span> <span class="n">_parent_0</span> <span class="o">=</span> <span class="n">ParentClass</span>
  <span class="kd">local</span> <span class="n">_base_0</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">a_method</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
      <span class="n">_class_0</span><span class="p">.</span><span class="n">__parent</span><span class="p">.</span><span class="n">__base</span><span class="p">.</span><span class="n">a_method</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span>
      <span class="n">_class_0</span><span class="p">.</span><span class="n">__parent</span><span class="p">.</span><span class="n">a_method</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span>
      <span class="n">_class_0</span><span class="p">.</span><span class="n">__parent</span><span class="p">.</span><span class="n">a_method</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span><span class="p">)</span>
      <span class="kr">return</span> <span class="nb">assert</span><span class="p">(</span><span class="n">_class_0</span><span class="p">.</span><span class="n">__parent</span> <span class="o">==</span> <span class="n">ParentClass</span><span class="p">)</span>
    <span class="kr">end</span>
  <span class="p">}</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">_base_0</span>
  <span class="nb">setmetatable</span><span class="p">(</span><span class="n">_base_0</span><span class="p">,</span> <span class="n">_parent_0</span><span class="p">.</span><span class="n">__base</span><span class="p">)</span>
  <span class="n">_class_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({</span>
    <span class="n">__init</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kr">return</span> <span class="n">_class_0</span><span class="p">.</span><span class="n">__parent</span><span class="p">.</span><span class="n">__init</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="p">...)</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">__base</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">,</span>
    <span class="n">__name</span> <span class="o">=</span> <span class="s2">&quot;MyClass&quot;</span><span class="p">,</span>
    <span class="n">__parent</span> <span class="o">=</span> <span class="n">_parent_0</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="n">__index</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="kd">local</span> <span class="n">val</span> <span class="o">=</span> <span class="nb">rawget</span><span class="p">(</span><span class="n">_base_0</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
      <span class="kr">if</span> <span class="n">val</span> <span class="o">==</span> <span class="kc">nil</span> <span class="kr">then</span>
        <span class="kd">local</span> <span class="n">parent</span> <span class="o">=</span> <span class="nb">rawget</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s2">&quot;__parent&quot;</span><span class="p">)</span>
        <span class="kr">if</span> <span class="n">parent</span> <span class="kr">then</span>
          <span class="kr">return</span> <span class="n">parent</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="kr">end</span>
      <span class="kr">else</span>
        <span class="kr">return</span> <span class="n">val</span>
      <span class="kr">end</span>
    <span class="kr">end</span><span class="p">,</span>
    <span class="n">__call</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kd">local</span> <span class="n">_self_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({},</span> <span class="n">_base_0</span><span class="p">)</span>
      <span class="n">cls</span><span class="p">.</span><span class="n">__init</span><span class="p">(</span><span class="n">_self_0</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kr">return</span> <span class="n">_self_0</span>
    <span class="kr">end</span>
  <span class="p">})</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__class</span> <span class="o">=</span> <span class="n">_class_0</span>
  <span class="kr">if</span> <span class="n">_parent_0</span><span class="p">.</span><span class="n">__inherited</span> <span class="kr">then</span>
    <span class="n">_parent_0</span><span class="p">.</span><span class="n">__inherited</span><span class="p">(</span><span class="n">_parent_0</span><span class="p">,</span> <span class="n">_class_0</span><span class="p">)</span>
  <span class="kr">end</span>
  <span class="n">MyClass</span> <span class="o">=</span> <span class="n">_class_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p><code>super</code> can also be used on left side of a <a href="#function_stubs">Function Stub</a>.
The only major difference is that instead of the resulting function being bound
to the value of <code>super</code>, it is bound to <code>self</code>.</p>

<h3 id="the-language/object-oriented-programming/types">Types</h3>

<p>Every instance of a class carries its type with it. This is stored in the
special <code>__class</code> property. This property holds the class object. The class
object is what we call to build a new instance. We can also index the class
object to retrieve class methods and properties.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">b</span> <span class="o">=</span> <span class="nc">BackPack</span><span class="o">!</span>
<span class="nb">assert</span> <span class="n">b</span><span class="o">.</span><span class="n">__class</span> <span class="o">==</span> <span class="nc">BackPack</span>

<span class="nb">print</span> <span class="nc">BackPack</span><span class="o">.</span><span class="n">size</span> <span class="c1">-- prints 10</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">b</span> <span class="o">=</span> <span class="n">BackPack</span><span class="p">()</span>
<span class="nb">assert</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">__class</span> <span class="o">==</span> <span class="n">BackPack</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">BackPack</span><span class="p">.</span><span class="n">size</span><span class="p">)</span></code></pre></td></tr>
</table>


<h3 id="the-language/object-oriented-programming/class-objects">Class Objects</h3>

<p>The class object is what we create when we use a <code>class</code> statement. The class
object is stored in a variable of the same name of the class.</p>

<p>The class object can be called like a function in order to create new
instances. That&rsquo;s how we created instances of classes in the examples above.</p>

<p>A class is made up of two tables. The class table itself, and the <em>base</em> table. The
<em>base</em> is used as the metatable for all the instances. All properties listed in
the class declaration are placed in the <em>base</em>.</p>

<p>The class object&rsquo;s metatable reads properties from the base if they don&rsquo;t exist
in the class object. This means we can access functions and properties directly
from the class.</p>

<p>It is important to note that assigning to the class object does not assign into
the <em>base</em>, so it&rsquo;s not a valid way to add new methods to instances. Instead
the <em>base</em> must explicitly be changed. See the <code>__base</code> field below.</p>

<p>The class object has a couple special properties:</p>

<p>The name of the class as when it was declared is stored as a string in the
<code>__name</code> field of the class object.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nb">print</span> <span class="nc">BackPack</span><span class="o">.</span><span class="n">__name</span> <span class="c1">-- prints Backpack</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="nb">print</span><span class="p">(</span><span class="n">BackPack</span><span class="p">.</span><span class="n">__name</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>The <em>base</em> object is stored in <code>__base</code>. We can modify this table to add
functionality to instances that have already been created and ones that are yet
to be created.</p>

<p>If the class extends from anything, the parent class object is stored in
<code>__parent</code>.</p>

<h3 id="the-language/object-oriented-programming/class-variables">Class Variables</h3>

<p>We can create variables directly in the class object instead of in the <em>base</em>
by using <code>@</code> in the front of the property name in a class declaration.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">Things</span>
  <span class="vc">@some_func</span><span class="o">:</span> <span class="nf">=&gt;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">Hello from</span><span class="s2">&quot;</span><span class="p">,</span> <span class="vc">@__name</span>

<span class="nc">Things</span><span class="o">\</span><span class="n">some_func</span><span class="o">!</span>

<span class="c1">-- class variables not visible in instances</span>
<span class="nb">assert</span> <span class="nc">Things</span><span class="kt">()</span><span class="o">.</span><span class="n">some_func</span> <span class="o">==</span> <span class="kc">nil</span></code></pre></td></tr>
</table>


<p>In expressions, we can use <code>@@</code> to access a value that is stored in the
<code>__class</code> of <code>self</code>.  Thus, <code>@@hello</code> is shorthand for <code>self.__class.hello</code>.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">Counter</span>
  <span class="vc">@count</span><span class="o">:</span> <span class="mi">0</span>

  <span class="nv">new:</span> <span class="nf">=&gt;</span>
    <span class="vc">@@count</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="nc">Counter</span><span class="o">!</span>
<span class="nc">Counter</span><span class="o">!</span>

<span class="nb">print</span> <span class="nc">Counter</span><span class="o">.</span><span class="n">count</span> <span class="c1">-- prints 2</span></code></pre></td></tr>
</table>


<p>The calling semantics of <code>@@</code> are similar to <code>@</code>. Calling a <code>@@</code> name will pass
the class in as the first argument using Lua&rsquo;s colon syntax.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="vc">@@hello</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">self</span><span class="p">.</span><span class="n">__class</span><span class="p">:</span><span class="n">hello</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span></code></pre></td></tr>
</table>


<h3 id="the-language/object-oriented-programming/class-declaration-statements">Class Declaration Statements</h3>

<p>In the body of a class declaration, we can have normal expressions in addition
to key/value pairs. In this context, <code>self</code> is equal to the class object.</p>

<p>Here is an alternative way to create a class variable compared to what&rsquo;s
described above:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">Things</span>
  <span class="vc">@class_var</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">hello world</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">Things</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_class_0</span>
  <span class="kd">local</span> <span class="n">_base_0</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__index</span> <span class="o">=</span> <span class="n">_base_0</span>
  <span class="n">_class_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({</span>
    <span class="n">__init</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span> <span class="kr">end</span><span class="p">,</span>
    <span class="n">__base</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">,</span>
    <span class="n">__name</span> <span class="o">=</span> <span class="s2">&quot;Things&quot;</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="n">__index</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">,</span>
    <span class="n">__call</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kd">local</span> <span class="n">_self_0</span> <span class="o">=</span> <span class="nb">setmetatable</span><span class="p">({},</span> <span class="n">_base_0</span><span class="p">)</span>
      <span class="n">cls</span><span class="p">.</span><span class="n">__init</span><span class="p">(</span><span class="n">_self_0</span><span class="p">,</span> <span class="p">...)</span>
      <span class="kr">return</span> <span class="n">_self_0</span>
    <span class="kr">end</span>
  <span class="p">})</span>
  <span class="n">_base_0</span><span class="p">.</span><span class="n">__class</span> <span class="o">=</span> <span class="n">_class_0</span>
  <span class="kd">local</span> <span class="n">self</span> <span class="o">=</span> <span class="n">_class_0</span>
  <span class="n">self</span><span class="p">.</span><span class="n">class_var</span> <span class="o">=</span> <span class="s2">&quot;hello world&quot;</span>
  <span class="n">Things</span> <span class="o">=</span> <span class="n">_class_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>These expressions are executed after all the properties have been added to the
<em>base</em>.</p>

<p>All variables declared in the body of the class are local to the classes
properties. This is convenient for placing private values or helper functions
that only the class methods can access:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">class</span> <span class="nc">MoreThings</span>
  <span class="n">secret</span> <span class="o">=</span> <span class="mi">123</span>
  <span class="n">log</span> <span class="o">=</span> <span class="kt">(</span><span class="n">msg</span><span class="kt">)</span> <span class="nf">-&gt;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">LOG:</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">msg</span>

  <span class="nv">some_method:</span> <span class="nf">=&gt;</span>
    <span class="n">log</span> <span class="s2">&quot;</span><span class="s">hello world: </span><span class="s2">&quot;</span> <span class="o">..</span> <span class="n">secret</span></code></pre></td></tr>
</table>


<h3 id="the-language/object-oriented-programming/-and-values"><code>@</code> and <code>@@</code> Values</h3>

<p>When <code>@</code> and <code>@@</code> are prefixed in front of a name they represent, respectively,
that name accessed in <code>self</code> and <code>self.__class</code>.</p>

<p>If they are used all by themselves, they are aliases for <code>self</code> and
<code>self.__class</code>.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nb">assert</span> <span class="vc">@</span> <span class="o">==</span> <span class="bp">self</span>
<span class="nb">assert</span> <span class="vc">@@</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="nb">assert</span><span class="p">(</span><span class="n">self</span> <span class="o">==</span> <span class="n">self</span><span class="p">)</span>
<span class="nb">assert</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">__class</span> <span class="o">==</span> <span class="n">self</span><span class="p">.</span><span class="n">__class</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>For example, a quick way to create a new instance of the same class from an
instance method using <code>@@</code>:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">some_instance_method</span> <span class="o">=</span> <span class="kt">(</span><span class="o">...</span><span class="kt">)</span> <span class="nf">=&gt;</span> <span class="vc">@@</span> <span class="o">...</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">some_instance_method</span>
<span class="n">some_instance_method</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="p">...)</span>
  <span class="kr">return</span> <span class="n">self</span><span class="p">.</span><span class="n">__class</span><span class="p">(...)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h3 id="the-language/object-oriented-programming/class-expressions">Class Expressions</h3>

<p>The <code>class</code> syntax can also be used as an expression which can be assigned to a
variable or explicitly returned.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">x</span> <span class="o">=</span> <span class="k">class</span> <span class="nc">Bucket</span>
  <span class="nv">drops:</span> <span class="mi">0</span>
  <span class="nv">add_drop:</span> <span class="nf">=&gt;</span> <span class="vc">@drops</span> <span class="o">+=</span> <span class="mi">1</span></code></pre></td></tr>
</table>


<h3 id="the-language/object-oriented-programming/anonymous-classes">Anonymous classes</h3>

<p>The name can be left out when declaring a class. The <code>__name</code> attribute will be
<code>nil</code>, unless the class expression is in an assignment. The name on the left
hand side of the assignment is used instead of <code>nil</code>.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nc">BigBucket</span> <span class="o">=</span> <span class="k">class</span> <span class="k">extends</span> <span class="nc">Bucket</span>
  <span class="nv">add_drop:</span> <span class="nf">=&gt;</span> <span class="vc">@drops</span> <span class="o">+=</span> <span class="mi">10</span>

<span class="nb">assert</span> <span class="nc">Bucket</span><span class="o">.</span><span class="n">__name</span> <span class="o">==</span> <span class="s2">&quot;</span><span class="s">BigBucket</span><span class="s2">&quot;</span></code></pre></td></tr>
</table>


<p>You can even leave off the body, meaning you can write a blank anonymous class
like this:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">x</span> <span class="o">=</span> <span class="k">class</span></code></pre></td></tr>
</table>


<h2 id="the-language/export-statement">Export Statement</h2>

<p>Because all assignments to variables that are not lexically visible will
be declared as local, special syntax is required to declare a variable globally.</p>

<p>The export keyword makes it so any following assignments to the specified names
will not be assigned locally.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">export</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_name2</span>
<span class="n">var_name</span><span class="p">,</span> <span class="n">var_name3</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">var_name3</span>
<span class="n">var_name</span><span class="p">,</span> <span class="n">var_name3</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span><span class="p">,</span> <span class="s2">&quot;world&quot;</span></code></pre></td></tr>
</table>


<p>This is especially useful when declaring what will be externally visible in a
module:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="c1">-- my_module.moon</span>
<span class="n">module</span> <span class="s2">&quot;</span><span class="s">my_module</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">package</span><span class="o">.</span><span class="n">seeall</span>
<span class="k">export</span> <span class="n">print_result</span>

<span class="n">length</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="kt">)</span> <span class="nf">-&gt;</span> <span class="nb">math.sqrt</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span>

<span class="n">print_result</span> <span class="o">=</span> <span class="kt">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">Length is </span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">length</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

<span class="c1">-- main.moon</span>
<span class="nb">require</span> <span class="s2">&quot;</span><span class="s">my_module</span><span class="s2">&quot;</span>

<span class="n">my_module</span><span class="o">.</span><span class="n">print_result</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span> <span class="c1">-- prints the result</span>

<span class="nb">print</span> <span class="n">my_module</span><span class="o">.</span><span class="n">length</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="c1">-- errors, `length` not visible</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">module</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">,</span> <span class="n">package</span><span class="p">.</span><span class="n">seeall</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">length</span>
<span class="n">length</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kr">return</span> <span class="nb">math.sqrt</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
<span class="kr">end</span>
<span class="n">print_result</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Length is &quot;</span><span class="p">,</span> <span class="n">length</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="kr">end</span>
<span class="nb">require</span><span class="p">(</span><span class="s2">&quot;my_module&quot;</span><span class="p">)</span>
<span class="n">my_module</span><span class="p">.</span><span class="n">print_result</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_module</span><span class="p">.</span><span class="n">length</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span></code></pre></td></tr>
</table>


<p>Assignment can be combined with the export keyword to assign to global
variables directly:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">export</span> <span class="n">some_number</span><span class="p">,</span> <span class="n">message_str</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">hello world</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="n">some_number</span><span class="p">,</span> <span class="n">message_str</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;hello world&quot;</span></code></pre></td></tr>
</table>


<p>Additionally, a class declaration can be prefixed with the export keyword in
order to export it.</p>

<p>Export will have no effect if there is already a local variable of the same
name in scope.</p>

<h3 id="the-language/export-statement/export-all-and-export-proper">Export All &amp; Export Proper</h3>

<p>The <code>export</code> statement can also take special symbols <code>*</code> and <code>^</code>.</p>

<p><code>export *</code> will cause any name declared after the statement to be exported in the
current scope. <code>export ^</code> will export all proper names, names that begin with a
capital letter.</p>

<h2 id="the-language/local-statement">Local Statement</h2>

<p>Sometimes you want to declare a variable name before the first time you assign
it. The <code>local</code> statement can be used to do that.</p>

<p>In this example we declare the variable <code>a</code> in the outer scope so its value
can be accessed after the <code>if</code> statement. If there was no <code>local</code> statement then
<code>a</code> would only be accessible inside the <code>if</code> statement.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">local</span> <span class="n">a</span>
<span class="k">if</span> <span class="n">something</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="nb">print</span> <span class="n">a</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">a</span>
<span class="kr">if</span> <span class="n">something</span> <span class="kr">then</span>
  <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span></code></pre></td></tr>
</table>


<p><code>local</code> can also be used to shadow existing variables for the rest of a scope.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
<span class="k">if</span> <span class="n">something</span>
  <span class="n">local</span> <span class="n">x</span>
  <span class="n">x</span> <span class="o">=</span> <span class="mi">12</span>
<span class="nb">print</span> <span class="n">x</span> <span class="c1">-- prints 10</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
<span class="kr">if</span> <span class="n">something</span> <span class="kr">then</span>
  <span class="kd">local</span> <span class="n">x</span>
  <span class="n">x</span> <span class="o">=</span> <span class="mi">12</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>When you have one function that calls another, you typically order them such
that the second function can access the first. If both functions happen to
call each other, then you must forward declare the names:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">local</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span>

<span class="n">first</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="n">second</span><span class="o">!</span>

<span class="n">second</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="n">first</span><span class="o">!</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span>
<span class="n">first</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">return</span> <span class="n">second</span><span class="p">()</span>
<span class="kr">end</span>
<span class="n">second</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">return</span> <span class="n">first</span><span class="p">()</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>The same problem occurs with declaring classes and regular values too.</p>

<p>Because forward declaring is often better than manually ordering your assigns,
a special form of <code>local</code> is provided:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">local</span> <span class="o">*</span>

<span class="n">first</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="nb">print</span> <span class="n">data</span>
  <span class="n">second</span><span class="o">!</span>

<span class="n">second</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="n">first</span><span class="o">!</span>

<span class="n">data</span> <span class="o">=</span> <span class="kt">{}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">data</span>
<span class="n">first</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">second</span><span class="p">()</span>
<span class="kr">end</span>
<span class="n">second</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">return</span> <span class="n">first</span><span class="p">()</span>
<span class="kr">end</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="p">}</span></code></pre></td></tr>
</table>


<p><code>local *</code> will forward declare all names below it in the current scope.</p>

<p>Similarly to <a href="#export_all_and_export_proper"><code>export</code></a> one more special form is
provided, <code>local ^</code>. This will forward declare all names that begin with a
capital letter.</p>

<h2 id="the-language/import-statement">Import Statement</h2>

<p>Often you want to bring some values from a table into the current scope as
local variables by their name. The import statement lets us accomplish this:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">import</span> <span class="n">insert</span> <span class="k">from</span> <span class="n">table</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">insert</span>
<span class="n">insert</span> <span class="o">=</span> <span class="nb">table.insert</span></code></pre></td></tr>
</table>


<p>The multiple names can be given, each separated by a comma:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">import</span> <span class="nc">C</span><span class="p">,</span> <span class="nc">Ct</span><span class="p">,</span> <span class="nc">Cmt</span> <span class="k">from</span> <span class="n">lpeg</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">C</span><span class="p">,</span> <span class="n">Ct</span><span class="p">,</span> <span class="n">Cmt</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_obj_0</span> <span class="o">=</span> <span class="n">lpeg</span>
  <span class="n">C</span><span class="p">,</span> <span class="n">Ct</span><span class="p">,</span> <span class="n">Cmt</span> <span class="o">=</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">C</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">Ct</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">Cmt</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Sometimes a function requires that the table be sent in as the first argument
(when using the <code>\</code> syntax). As a shortcut, we can prefix the name
with a <code>\</code> to bind it to that table:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="c1">-- some object</span>
<span class="n">my_module</span> <span class="o">=</span>
  <span class="nv">state:</span> <span class="mi">100</span>
  <span class="nv">add:</span> <span class="kt">(</span><span class="n">value</span><span class="kt">)</span> <span class="nf">=&gt;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">+</span> <span class="n">value</span>

<span class="k">import</span> <span class="o">\</span><span class="n">add</span> <span class="k">from</span> <span class="n">my_module</span>

<span class="nb">print</span> <span class="n">add</span> <span class="mi">22</span> <span class="c1">-- equivalent to calling my_module\add 22</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">my_module</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">state</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
  <span class="n">add</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="kr">return</span> <span class="n">self</span><span class="p">.</span><span class="n">state</span> <span class="o">+</span> <span class="n">value</span>
  <span class="kr">end</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">add</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_base_0</span> <span class="o">=</span> <span class="n">my_module</span>
  <span class="kd">local</span> <span class="n">_fn_0</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">.</span><span class="n">add</span>
  <span class="n">add</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(...)</span>
    <span class="kr">return</span> <span class="n">_fn_0</span><span class="p">(</span><span class="n">_base_0</span><span class="p">,</span> <span class="p">...)</span>
  <span class="kr">end</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="mi">22</span><span class="p">))</span></code></pre></td></tr>
</table>


<p>When handing multiple imports you can substitute the comma with a newline and
any amount of whitespace. When working with a lot of imports you might write
something like this:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">import</span>
  <span class="n">assert_csrf</span>
  <span class="n">assert_timezone</span>
  <span class="n">not_found</span>
  <span class="n">require_login</span>
  <span class="k">from</span> <span class="nb">require</span> <span class="s2">&quot;</span><span class="s">helpers</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">assert_csrf</span><span class="p">,</span> <span class="n">assert_timezone</span><span class="p">,</span> <span class="n">not_found</span><span class="p">,</span> <span class="n">require_login</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_obj_0</span> <span class="o">=</span> <span class="nb">require</span><span class="p">(</span><span class="s2">&quot;helpers&quot;</span><span class="p">)</span>
  <span class="n">assert_csrf</span><span class="p">,</span> <span class="n">assert_timezone</span><span class="p">,</span> <span class="n">not_found</span><span class="p">,</span> <span class="n">require_login</span> <span class="o">=</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">assert_csrf</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">assert_timezone</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">not_found</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">require_login</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h2 id="the-language/with-statement">With Statement</h2>

<p>A common pattern involving the creation of an object is calling a series of
functions and setting a series of properties immediately after creating it.</p>

<p>This results in repeating the name of the object multiple times in code, adding
unnecessary noise. A common solution to this is to pass a table in as an
argument which contains a collection of keys and values to overwrite. The
downside to this is that the constructor of this object must support this form.</p>

<p>The <code>with</code> block helps to alleviate this. Within a <code>with</code> block we can use a
special statements that begin with either <code>.</code> or <code>\</code> which represent
those operations applied to the object we are using <code>with</code> on.</p>

<p>For example, we work with a newly created object:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">with</span> <span class="nc">Person</span><span class="o">!</span>
  <span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Oswald</span><span class="s2">&quot;</span>
  <span class="o">\</span><span class="n">add_relative</span> <span class="n">my_dad</span>
  <span class="o">\</span><span class="n">save</span><span class="o">!</span>
  <span class="nb">print</span> <span class="o">.</span><span class="n">name</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_with_0</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
  <span class="n">_with_0</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Oswald&quot;</span>
  <span class="n">_with_0</span><span class="p">:</span><span class="n">add_relative</span><span class="p">(</span><span class="n">my_dad</span><span class="p">)</span>
  <span class="n">_with_0</span><span class="p">:</span><span class="n">save</span><span class="p">()</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">_with_0</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>The <code>with</code> statement can also be used as an expression which returns the value
it has been giving access to.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">file</span> <span class="o">=</span> <span class="k">with</span> <span class="nc">File</span> <span class="s2">&quot;</span><span class="s">favorite_foods.txt</span><span class="s2">&quot;</span>
  <span class="o">\</span><span class="n">set_encoding</span> <span class="s2">&quot;</span><span class="s">utf8</span><span class="s2">&quot;</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">file</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_with_0</span> <span class="o">=</span> <span class="n">File</span><span class="p">(</span><span class="s2">&quot;favorite_foods.txt&quot;</span><span class="p">)</span>
  <span class="n">_with_0</span><span class="p">:</span><span class="n">set_encoding</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">)</span>
  <span class="n">file</span> <span class="o">=</span> <span class="n">_with_0</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>Or&hellip;</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">create_person</span> <span class="o">=</span> <span class="kt">(</span><span class="n">name</span><span class="p">,</span>  <span class="n">relatives</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="k">with</span> <span class="nc">Person</span><span class="o">!</span>
    <span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="o">\</span><span class="n">add_relative</span> <span class="n">relative</span> <span class="k">for</span> <span class="n">relative</span> <span class="k">in</span> <span class="o">*</span><span class="n">relatives</span>

<span class="n">me</span> <span class="o">=</span> <span class="n">create_person</span> <span class="s2">&quot;</span><span class="s">Leaf</span><span class="s2">&quot;</span><span class="p">,</span> <span class="kt">{</span><span class="n">dad</span><span class="p">,</span> <span class="n">mother</span><span class="p">,</span> <span class="n">sister</span><span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">create_person</span>
<span class="n">create_person</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">relatives</span><span class="p">)</span>
  <span class="kr">do</span>
    <span class="kd">local</span> <span class="n">_with_0</span> <span class="o">=</span> <span class="n">Person</span><span class="p">()</span>
    <span class="n">_with_0</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">relatives</span> <span class="kr">do</span>
      <span class="kd">local</span> <span class="n">relative</span> <span class="o">=</span> <span class="n">relatives</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
      <span class="n">_with_0</span><span class="p">:</span><span class="n">add_relative</span><span class="p">(</span><span class="n">relative</span><span class="p">)</span>
    <span class="kr">end</span>
    <span class="kr">return</span> <span class="n">_with_0</span>
  <span class="kr">end</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">me</span> <span class="o">=</span> <span class="n">create_person</span><span class="p">(</span><span class="s2">&quot;Leaf&quot;</span><span class="p">,</span> <span class="p">{</span>
  <span class="n">dad</span><span class="p">,</span>
  <span class="n">mother</span><span class="p">,</span>
  <span class="n">sister</span>
<span class="p">})</span></code></pre></td></tr>
</table>


<p>In this usage, <code>with</code> can be seen as a special form of the K combinator.</p>

<p>The expression in the <code>with</code> statement can also be an assignment, if you want
to give a name to the expression.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">with</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Hello</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">original:</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">str</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">upper:</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">\</span><span class="n">upper</span><span class="o">!</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">do</span>
  <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="s2">&quot;Hello&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;original:&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;upper:&quot;</span><span class="p">,</span> <span class="n">str</span><span class="p">:</span><span class="n">upper</span><span class="p">())</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h2 id="the-language/do">Do</h2>

<p>When used as a statement, <code>do</code> works just like it does in Lua.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="k">do</span>
  <span class="n">var</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span>
  <span class="nb">print</span> <span class="n">var</span>
<span class="nb">print</span> <span class="n">var</span> <span class="c1">-- nil here</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kr">do</span>
  <span class="kd">local</span> <span class="n">var</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="n">var</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>MoonScript&rsquo;s <code>do</code> can also be used an expression . Allowing you to combine
multiple lines into one. The result of the <code>do</code> expression is the last
statement in its body.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">counter</span> <span class="o">=</span> <span class="k">do</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="nf">-&gt;</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">i</span>

<span class="nb">print</span> <span class="n">counter</span><span class="o">!</span>
<span class="nb">print</span> <span class="n">counter</span><span class="o">!</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">counter</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">counter</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="kr">return</span> <span class="n">i</span>
  <span class="kr">end</span>
<span class="kr">end</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">counter</span><span class="p">())</span></code></pre></td></tr>
</table>


<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">tbl</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="nv">key:</span> <span class="k">do</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">assigning key!</span><span class="s2">&quot;</span>
    <span class="mi">1234</span>
<span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">tbl</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">key</span> <span class="o">=</span> <span class="p">(</span><span class="kr">function</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;assigning key!&quot;</span><span class="p">)</span>
    <span class="kr">return</span> <span class="mi">1234</span>
  <span class="kr">end</span><span class="p">)()</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<h2 id="the-language/destructuring-assignment">Destructuring Assignment</h2>

<p>Destructuring assignment is a way to quickly extract values from a table by
their name or position in array based tables.</p>

<p>Typically when you see a table literal, <code>{1,2,3}</code>, it is on the right hand side
of an assignment because it is a value. Destructuring assignment swaps the role
of the table literal, and puts it on the left hand side of an assign
statement.</p>

<p>This is best explained with examples. Here is how you would unpack the first
two values from a table:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">thing</span> <span class="o">=</span> <span class="kt">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="kt">}</span>

<span class="kt">{</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="kt">}</span> <span class="o">=</span> <span class="n">thing</span>
<span class="nb">print</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">thing</span> <span class="o">=</span> <span class="p">{</span>
  <span class="mi">1</span><span class="p">,</span>
  <span class="mi">2</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span>
<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">thing</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">thing</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>In the destructuring table literal, the key represents the key to read from the
right hand side, and the value represents the name the read value will be
assigned to.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">obj</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="nv">hello:</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span>
  <span class="nv">day:</span> <span class="s2">&quot;</span><span class="s">tuesday</span><span class="s2">&quot;</span>
  <span class="nv">length:</span> <span class="mi">20</span>
<span class="kt">}</span>

<span class="kt">{</span><span class="nv">hello:</span> <span class="n">hello</span><span class="p">,</span> <span class="nv">day:</span> <span class="n">the_day</span><span class="kt">}</span> <span class="o">=</span> <span class="n">obj</span>
<span class="nb">print</span> <span class="n">hello</span><span class="p">,</span> <span class="n">the_day</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">obj</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">hello</span> <span class="o">=</span> <span class="s2">&quot;world&quot;</span><span class="p">,</span>
  <span class="n">day</span> <span class="o">=</span> <span class="s2">&quot;tuesday&quot;</span><span class="p">,</span>
  <span class="n">length</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">hello</span><span class="p">,</span> <span class="n">the_day</span>
<span class="n">hello</span><span class="p">,</span> <span class="n">the_day</span> <span class="o">=</span> <span class="n">obj</span><span class="p">.</span><span class="n">hello</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="n">day</span>
<span class="nb">print</span><span class="p">(</span><span class="n">hello</span><span class="p">,</span> <span class="n">the_day</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>This also works with nested data structures as well:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">obj2</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="nv">numbers:</span> <span class="kt">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="kt">}</span>
  <span class="nv">properties:</span> <span class="kt">{</span>
    <span class="nv">color:</span> <span class="s2">&quot;</span><span class="s">green</span><span class="s2">&quot;</span>
    <span class="nv">height:</span> <span class="mf">13.5</span>
  <span class="kt">}</span>
<span class="kt">}</span>

<span class="kt">{</span><span class="nv">numbers:</span> <span class="kt">{</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="kt">}}</span> <span class="o">=</span> <span class="n">obj2</span>
<span class="nb">print</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">color</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">obj2</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">numbers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">,</span>
    <span class="mi">4</span>
  <span class="p">},</span>
  <span class="n">properties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span>
    <span class="n">height</span> <span class="o">=</span> <span class="mf">13.5</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span>
<span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="o">=</span> <span class="n">obj2</span><span class="p">.</span><span class="n">numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">obj2</span><span class="p">.</span><span class="n">numbers</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">color</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>If the destructuring statement is complicated, feel free to spread it out over
a few lines. A slightly more complicated example:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="kt">{</span>
  <span class="nv">numbers:</span> <span class="kt">{</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span> <span class="kt">}</span>
  <span class="nv">properties:</span> <span class="kt">{</span>
    <span class="nv">color:</span> <span class="n">color</span>
  <span class="kt">}</span>
<span class="kt">}</span> <span class="o">=</span> <span class="n">obj2</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">color</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_obj_0</span> <span class="o">=</span> <span class="n">obj2</span>
  <span class="n">first</span><span class="p">,</span> <span class="n">second</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">numbers</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">numbers</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">properties</span><span class="p">.</span><span class="n">color</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>It&rsquo;s common to extract values from at table and assign them the local variables
that have the same name as the key. In order to avoid repetition we can use the
<code>:</code> prefix operator:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="kt">{</span><span class="nv">:concat</span><span class="p">,</span> <span class="nv">:insert</span><span class="kt">}</span> <span class="o">=</span> <span class="n">table</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">concat</span><span class="p">,</span> <span class="n">insert</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_obj_0</span> <span class="o">=</span> <span class="n">table</span>
  <span class="n">concat</span><span class="p">,</span> <span class="n">insert</span> <span class="o">=</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">concat</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">insert</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>This is effectively the same as import, but we can rename fields we want to
extract by mixing the syntax:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="kt">{</span><span class="nv">:mix</span><span class="p">,</span> <span class="nv">:max</span><span class="p">,</span> <span class="nv">random:</span> <span class="n">rand</span> <span class="kt">}</span> <span class="o">=</span> <span class="n">math</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">mix</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">rand</span>
<span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_obj_0</span> <span class="o">=</span> <span class="n">math</span>
  <span class="n">mix</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">rand</span> <span class="o">=</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">mix</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">max</span><span class="p">,</span> <span class="n">_obj_0</span><span class="p">.</span><span class="n">random</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<h3 id="the-language/destructuring-assignment/destructuring-in-other-places">Destructuring In Other Places</h3>

<p>Destructuring can also show up in places where an assignment implicitly takes
place. An example of this is a <code>for</code> loop:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">tuples</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="kt">{</span><span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">world</span><span class="s2">&quot;</span><span class="kt">}</span>
  <span class="kt">{</span><span class="s2">&quot;</span><span class="s">egg</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="s">head</span><span class="s2">&quot;</span><span class="kt">}</span>
<span class="kt">}</span>

<span class="k">for</span> <span class="kt">{</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="kt">}</span> <span class="k">in</span> <span class="o">*</span><span class="n">tuples</span>
  <span class="nb">print</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">tuples</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">{</span>
    <span class="s2">&quot;hello&quot;</span><span class="p">,</span>
    <span class="s2">&quot;world&quot;</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="s2">&quot;egg&quot;</span><span class="p">,</span>
    <span class="s2">&quot;head&quot;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="kr">for</span> <span class="n">_index_0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">#</span><span class="n">tuples</span> <span class="kr">do</span>
  <span class="kd">local</span> <span class="n">_des_0</span> <span class="o">=</span> <span class="n">tuples</span><span class="p">[</span><span class="n">_index_0</span><span class="p">]</span>
  <span class="kd">local</span> <span class="n">left</span><span class="p">,</span> <span class="n">right</span>
  <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="n">_des_0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">_des_0</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
<span class="kr">end</span></code></pre></td></tr>
</table>


<p>We know each element in the array table is a two item tuple, so we can unpack
it directly in the names clause of the for statement using a destructure.</p>

<h2 id="the-language/function-stubs">Function Stubs</h2>

<p>It is common to pass a function from an object around as a value, for example,
passing an instance method into a function as a callback. If the function
expects the object it is operating on as the first argument then you must
somehow bundle that object with the function so it can be called properly.</p>

<p>The function stub syntax is a shorthand for creating a new closure function
that bundles both the object and function. This new function calls the wrapped
function in the correct context of the object.</p>

<p>Its syntax is the same as calling an instance method with the <code>\</code> operator but
with no argument list provided.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">my_object</span> <span class="o">=</span> <span class="kt">{</span>
  <span class="nv">value:</span> <span class="mi">1000</span>
  <span class="nv">write:</span> <span class="nf">=&gt;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">the value:</span><span class="s2">&quot;</span><span class="p">,</span> <span class="vc">@value</span>
<span class="kt">}</span>

<span class="n">run_callback</span> <span class="o">=</span> <span class="kt">(</span><span class="n">func</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">running callback...</span><span class="s2">&quot;</span>
  <span class="n">func</span><span class="o">!</span>

<span class="c1">-- this will not work:</span>
<span class="c1">-- the function has to no reference to my_object</span>
<span class="n">run_callback</span> <span class="n">my_object</span><span class="o">.</span><span class="n">write</span>

<span class="c1">-- function stub syntax</span>
<span class="c1">-- lets us bundle the object into a new function</span>
<span class="n">run_callback</span> <span class="n">my_object</span><span class="o">\</span><span class="n">write</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">my_object</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">value</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
  <span class="n">write</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">self</span><span class="p">)</span>
    <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the value:&quot;</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
  <span class="kr">end</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">run_callback</span>
<span class="n">run_callback</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;running callback...&quot;</span><span class="p">)</span>
  <span class="kr">return</span> <span class="n">func</span><span class="p">()</span>
<span class="kr">end</span>
<span class="n">run_callback</span><span class="p">(</span><span class="n">my_object</span><span class="p">.</span><span class="n">write</span><span class="p">)</span>
<span class="n">run_callback</span><span class="p">((</span><span class="kr">function</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">_base_0</span> <span class="o">=</span> <span class="n">my_object</span>
  <span class="kd">local</span> <span class="n">_fn_0</span> <span class="o">=</span> <span class="n">_base_0</span><span class="p">.</span><span class="n">write</span>
  <span class="kr">return</span> <span class="kr">function</span><span class="p">(...)</span>
    <span class="kr">return</span> <span class="n">_fn_0</span><span class="p">(</span><span class="n">_base_0</span><span class="p">,</span> <span class="p">...)</span>
  <span class="kr">end</span>
<span class="kr">end</span><span class="p">)())</span></code></pre></td></tr>
</table>


<h2 id="the-language/the-using-clause-controlling-destructive-assignment">The Using Clause; Controlling Destructive Assignment</h2>

<p>While lexical scoping can be a great help in reducing the complexity of the
code we write, things can get unwieldy as the code size increases. Consider
the following snippet:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1">-- many lines of code...</span>

<span class="n">my_func</span> <span class="o">=</span> <span class="nf">-&gt;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="nb">print</span> <span class="n">i</span>
    <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>

<span class="n">my_func</span><span class="o">!</span>

<span class="nb">print</span> <span class="n">i</span> <span class="c1">-- will print 0</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">100</span>
<span class="kd">local</span> <span class="n">my_func</span>
<span class="n">my_func</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="kr">while</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="kr">do</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
  <span class="kr">end</span>
<span class="kr">end</span>
<span class="n">my_func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>In <code>my_func</code>, we've overwritten the value of <code>i</code> mistakenly. In this example it
is quite obvious, but consider a large, or foreign code base where it isn&rsquo;t
clear what names have already been declared.</p>

<p>It would be helpful to say which variables from the enclosing scope we intend
on change, in order to prevent us from changing others by accident.</p>

<p>The <code>using</code> keyword lets us do that. <code>using nil</code> makes sure that no closed
variables are overwritten in assignment. The <code>using</code> clause is placed after the
argument list in a function, or in place of it if there are no arguments.</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">i</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">my_func</span> <span class="o">=</span> <span class="kt">(</span><span class="k">using</span> <span class="kc">nil</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span> <span class="c1">-- a new local variable is created here</span>

<span class="n">my_func</span><span class="o">!</span>
<span class="nb">print</span> <span class="n">i</span> <span class="c1">-- prints 100, i is unaffected</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">100</span>
<span class="kd">local</span> <span class="n">my_func</span>
<span class="n">my_func</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kd">local</span> <span class="n">i</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
<span class="kr">end</span>
<span class="n">my_func</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></code></pre></td></tr>
</table>


<p>Multiple names can be separated by commas. Closure values can still be
accessed, they just cant be modified:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="n">tmp</span> <span class="o">=</span> <span class="mi">1213</span>
<span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span>

<span class="n">my_func</span> <span class="o">=</span> <span class="kt">(</span><span class="n">add</span> <span class="k">using</span> <span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="kt">)</span> <span class="nf">-&gt;</span>
  <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">add</span> <span class="c1">-- a new local tmp is created</span>
  <span class="n">i</span> <span class="o">+=</span> <span class="n">tmp</span>
  <span class="n">k</span> <span class="o">+=</span> <span class="n">tmp</span>

<span class="n">my_func</span><span class="kt">(</span><span class="mi">22</span><span class="kt">)</span>
<span class="nb">print</span> <span class="n">i</span><span class="p">,</span><span class="n">k</span> <span class="c1">-- these have been updated</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">tmp</span> <span class="o">=</span> <span class="mi">1213</span>
<span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">50</span>
<span class="kd">local</span> <span class="n">my_func</span>
<span class="n">my_func</span> <span class="o">=</span> <span class="kr">function</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
  <span class="kd">local</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">+</span> <span class="n">add</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">tmp</span>
  <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">tmp</span>
<span class="kr">end</span>
<span class="n">my_func</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span></code></pre></td></tr>
</table>


<h2 id="the-language/misc">Misc.</h2>

<h3 id="the-language/misc/implicit-returns-on-files">Implicit Returns on Files</h3>

<p>By default, a file will also implicitly return like a function. This is useful
for writing modules, where you can put your module&rsquo;s table as the last
statement in the file so it is returned when loaded with <code>require</code>.</p>

<h3 id="the-language/misc/writing-modules">Writing Modules</h3>

<p>Lua 5.2 has removed the <code>module</code> function for creating modules. It is
recommended to return a table instead when defining a module.</p>

<p>We can cleanly define modules by using the shorthand hash table key/value
syntax:</p>

<table width="100%" cellspacing="0" cellpadding="0" class="code-split"><tr><td class="code-split-left"><div class="code-header">MoonScript</div>
<pre><code class="moon-code"><span></span><span class="nc">MY_CONSTANT</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">hello</span><span class="s2">&quot;</span>

<span class="n">my_function</span> <span class="o">=</span> <span class="nf">-&gt;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">the function</span><span class="s2">&quot;</span>
<span class="n">my_second_function</span> <span class="o">=</span> <span class="nf">-&gt;</span> <span class="nb">print</span> <span class="s2">&quot;</span><span class="s">another function</span><span class="s2">&quot;</span>

<span class="kt">{</span> <span class="nv">:my_function</span><span class="p">,</span> <span class="nv">:my_second_function</span><span class="p">,</span> <span class="nv">:MY_CONSTANT</span><span class="kt">}</span></code></pre></td>
<td class="code-split-right"><div class="code-header code-header-right">Lua</div>
<pre><code class="lua-code"><span></span><span class="kd">local</span> <span class="n">MY_CONSTANT</span> <span class="o">=</span> <span class="s2">&quot;hello&quot;</span>
<span class="kd">local</span> <span class="n">my_function</span>
<span class="n">my_function</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;the function&quot;</span><span class="p">)</span>
<span class="kr">end</span>
<span class="kd">local</span> <span class="n">my_second_function</span>
<span class="n">my_second_function</span> <span class="o">=</span> <span class="kr">function</span><span class="p">()</span>
  <span class="kr">return</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;another function&quot;</span><span class="p">)</span>
<span class="kr">end</span>
<span class="kr">return</span> <span class="p">{</span>
  <span class="n">my_function</span> <span class="o">=</span> <span class="n">my_function</span><span class="p">,</span>
  <span class="n">my_second_function</span> <span class="o">=</span> <span class="n">my_second_function</span><span class="p">,</span>
  <span class="n">MY_CONSTANT</span> <span class="o">=</span> <span class="n">MY_CONSTANT</span>
<span class="p">}</span></code></pre></td></tr>
</table>


<p>If you need to forward declare your values so you can access them regardless of
their written order you can add <code>local *</code> to the top of your file.</p>

<h1 id="license-mit">License (MIT)</h1>

<pre><code>Copyright (C) 2020 by Leaf Corcoran

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
</code></pre>

  </div>

  <div class="footer">Generated on Fri Feb 27 00:42:15 2026; MoonScript v0.5.0</div>
</body>
</html>
